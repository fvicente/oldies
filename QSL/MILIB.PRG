********************************************************************************
PROCEDURE INCREMENTAR
********************************************************************************
PARAMETERS X
X=X+1
IF X>CNTMNU
	X=1
ENDIF
IF PALAB[X]=="~~"
	X=X+1
	IF X>CNTMNU
		X=1
	ENDIF
ENDIF
RETURN

********************************************************************************
PROCEDURE DECREMENTAR
********************************************************************************
PARAMETERS X
X=X-1
IF X<1
	X=CNTMNU
ENDIF
IF PALAB[X]=="~~"
	X=X-1
	IF X<1
		X=CNTMNU
	ENDIF
ENDIF
RETURN

********************************************************************************
PROCEDURE PINTAMENU
********************************************************************************
CONTTEMP=0
DO WHILE (LEFT(PALAB[POSMENU], 1)=="~")
	POSMENU=POSMENU-1
	CONTTEMP=CONTTEMP+1
ENDDO
MOUSE_OFF()
FOR NN=1 TO CNTMNU
	IF (LEFT(PALAB[NN], 1)!="~")
	VARCOL="W"
	IF NN==POSMENU
	   IF SUBMENU=.F.
	   SET COLOR TO ("N/W")
	   @ 24, 0 SAY MENSAJE[NN]
	   ENDIF
	   VARCOL="G"
	ENDIF

	SET COLOR TO ("N/"+VARCOL)
	@ YY[NN], XX[NN] SAY PALAB[NN]

	IF POSK[NN]!=0
		SET COLOR TO ("R/"+VARCOL)
		@ YY[NN], XX[NN]+POSK[NN]-1 SAY RAPIDA[NN]
	ENDIF
	ENDIF
NEXT NN
MOUSE_ON()
POSMENU=POSMENU+CONTTEMP
RETURN

********************************************************************************
PROCEDURE PINTASUBMENU
********************************************************************************
NN=POSMENU
DO WHILE (LEFT(PALAB[NN], 1)=="~")
	NN=NN-1
ENDDO
POSSUB[NN]=POSMENU-NN-1
NN=NN+1
YY1=YY[NN]-1
XX1=XX[NN]-2
DO WHILE (LEFT(PALAB[NN], 1)=="~")
	INCREMENTAR(@NN)
ENDDO
DECREMENTAR(@NN)
YY2=YY[NN]+2
XX2=XX[NN]+LEN(PALAB[NN])+1
MOUSE_OFF()
ACTUAL=SAVESCREEN(YY1,XX1,YY2,XX2)
NN=POSMENU
DO WHILE (LEFT(PALAB[NN], 1)=="~")
	NN=NN-1
ENDDO
NN=NN+1
SET COLOR TO ("N/W")
@ YY1, XX1+1 TO YY2-1, XX2-2
FOR FG=YY1 TO YY2-1
	SET COLOR TO ("N/W")
	@ FG, XX1 SAY " "
	@ FG, XX2-1 SAY " "
//	SET COLOR TO ("N+/N")
//        @ FG+1, XX2 SAY "°"
NEXT FG
//@ YY2, XX1+2 SAY REPLICATE("°",XX2-XX1-1)
SOMBRA(YY1, XX1, YY2-1, XX2-1)
DO WHILE (LEFT(PALAB[NN], 1)=="~")
	VARCOL="W"
	IF NN==POSMENU
		SET COLOR TO ("N/W")
		@ 24, 0 SAY MENSAJE[NN]
		VARCOL="G"
	ENDIF

	SET COLOR TO ("N/"+VARCOL)
	IF PALAB[NN]!="~~"
		@ YY[NN], XX[NN] SAY SUBSTR(PALAB[NN], 2, LEN(PALAB[NN])-1)
	ELSE
                @ YY[NN], XX[NN]-1 SAY "Ã"+REPLICATE("Ä", (XX2-XX1)-4)+"´"
	ENDIF
	IF POSK[NN]!=0
		SET COLOR TO ("R/"+VARCOL)
		@ YY[NN], XX[NN]+POSK[NN]-2 SAY RAPIDA[NN]
	ENDIF
	NN=NN+1
	IF NN>CNTMNU
		NN=1
	ENDIF
ENDDO
MOUSE_ON()
RETURN

********************************************************************************
PROCEDURE SUBM2
********************************************************************************
NN=POSMENU
DO WHILE (LEFT(PALAB[NN], 1)=="~")
	NN=NN-1
ENDDO
POSSUB[NN]=POSMENU-NN-1
NN=NN+1
MOUSE_OFF()
DO WHILE (LEFT(PALAB[NN], 1)=="~")
	VARCOL="W"
	IF NN==POSMENU
		SET COLOR TO ("N/W")
		@ 24, 0 SAY MENSAJE[NN]
		VARCOL="G"
	ENDIF

	SET COLOR TO ("N/"+VARCOL)
	IF PALAB[NN]!="~~"
		@ YY[NN], XX[NN] SAY SUBSTR(PALAB[NN], 2, LEN(PALAB[NN])-1)
	ELSE
                @ YY[NN], XX[NN]-1 SAY "Ã"+REPLICATE("Ä", (XX2-XX1)-4)+"´"
	ENDIF
	IF POSK[NN]!=0
		SET COLOR TO ("R/"+VARCOL)
		@ YY[NN], XX[NN]+POSK[NN]-2 SAY RAPIDA[NN]
	ENDIF
	NN=NN+1
	IF NN>CNTMNU
		NN=1
	ENDIF
ENDDO
MOUSE_ON()
RETURN

********************************************************************************
PROCEDURE RESTAURAR
********************************************************************************
IF (ACTUAL!="ú")
	MOUSE_OFF()
	RESTSCREEN(YY1, XX1, YY2, XX2, ACTUAL)
	MOUSE_ON()
ENDIF
RETURN

********************************************************************************
PROCEDURE SMENU
********************************************************************************
PARAMETERS DEVUELVO
MOUSE_ON()
X_MOUSE=0
Y_MOUSE=0
TECLA=0
MOUSE=0
IF (TODO)
DO PINTAMENU
IF (LEFT(PALAB[POSMENU], 1)=="~")
	DO PINTASUBMENU
ENDIF
ELSE
	TODO=.F.
ENDIF
MANTIENE()
DO WHILE (.T.)
   MOUSE=0
   TECLA=0
   VARTIEMPO=SECONDS()
   SPAUSA()

   IF (MOUSE!=1) .AND. (MOUSE!=0)
	MANTIENE()
   ENDIF

   IF (MOUSE==1)
	TEMP=0
	FOR A=1 TO CNTMNU
		IF (LEFT(PALAB[A], 1)!="~") .AND. (XX[A]<=X_MOUSE) .AND. (XX[A]+LEN(PALAB[A])-1>=X_MOUSE) .AND. (YY[A]==Y_MOUSE)
			TEMP=A
		ENDIF
	NEXT A
	IF (TEMP!=0)
		IF (POSMENU-POSSUB[TEMP]-1!=TEMP)
			POSMENU=TEMP
			INCREMENTAR(@POSMENU)
			IF (LEFT(PALAB[POSMENU], 1)!="~")
				DECREMENTAR(@POSMENU)
				RESTAURAR()
				DO PINTAMENU
				DEVUELVO=POSMENU
				MOUSE_OFF()
				RETURN
			ELSE
				SUBMENU=.T.
				DO RESTAURAR
				DO PINTAMENU
				POSMENU=POSMENU+POSSUB[POSMENU-1]
				DO PINTASUBMENU
			ENDIF
		ELSE
			IF (SUBMENU)
				SUBMENU=.F.
				DO WHILE (LEFT(PALAB[POSMENU], 1)=="~")
					DECREMENTAR(@POSMENU)
				ENDDO 
				RESTAURAR()
				DO PINTAMENU
			ELSE
				INCREMENTAR(@POSMENU)
				IF (LEFT(PALAB[POSMENU], 1)!="~")
					DECREMENTAR(@POSMENU)
				ELSE
					SUBMENU=.T.
					POSMENU=POSMENU+POSSUB[POSMENU-1]
					DO PINTASUBMENU
				ENDIF
			ENDIF
		ENDIF
	ELSE
		IF (LEFT(PALAB[POSMENU], 1)=="~")
			TEMP=POSMENU
			DO WHILE (LEFT(PALAB[TEMP], 1)=="~")
				DECREMENTAR(@TEMP)
			ENDDO
			POSTEMP=TEMP
			INCREMENTAR(@TEMP)
			DO WHILE (LEFT(PALAB[TEMP], 1)=="~")
				IF (XX[TEMP]<=X_MOUSE) .AND. (XX[TEMP]+LEN(PALAB[TEMP])-1>X_MOUSE) .AND. (YY[TEMP]==Y_MOUSE)
					POSMENU=TEMP
					POSSUB[POSTEMP]=TEMP-POSTEMP
					DO SUBM2
					DEVUELVO=POSMENU
					RESTAURAR()
					MOUSE_OFF()
					RETURN
				ENDIF
				INCREMENTAR(@TEMP)
			ENDDO
		ENDIF
	ENDIF
	MANTIENE()
   ELSE

   DO CASE
      CASE TECLA==13 // ENTER
	INCREMENTAR(@POSMENU)
	IF (LEFT(PALAB[POSMENU], 1)=="~") .AND. (SUBMENU==.F.)
		SUBMENU=.T.
		POSMENU=POSMENU+POSSUB[POSMENU-1]
		DO PINTASUBMENU
	ELSE
		DECREMENTAR(@POSMENU)
		DEVUELVO=POSMENU
		RESTAURAR()
		MOUSE_OFF()
		RETURN
	ENDIF

      CASE TECLA==27 // ESC
	IF (SUBMENU)
		SUBMENU=.F.
		DO WHILE (LEFT(PALAB[POSMENU], 1)=="~")
			DECREMENTAR(@POSMENU)
		ENDDO
		RESTAURAR()
		DO PINTAMENU
	ELSE
		DEVUELVO=0
		MOUSE_OFF()
		RESTAURAR()
		RETURN
	ENDIF
      CASE TECLA==4 // DERECHA
	INCREMENTAR(@POSMENU)
	DO WHILE (LEFT(PALAB[POSMENU], 1)=="~")
		INCREMENTAR(@POSMENU)
	ENDDO

	IF (!SUBMENU)
		DO PINTAMENU
	ELSE
		RESTAURAR()
		INCREMENTAR(@POSMENU)
		IF (LEFT(PALAB[POSMENU], 1)=="~")
			POSMENU=POSMENU+POSSUB[POSMENU-1]
			DO PINTAMENU
			DO PINTASUBMENU
		ELSE
                        ACTUAL="ú"
			DECREMENTAR(@POSMENU)
			DO PINTAMENU
		ENDIF
	ENDIF
      CASE TECLA==19 // IZQUIERDA
	DO WHILE (LEFT(PALAB[POSMENU], 1)=="~")
		DECREMENTAR(@POSMENU)
	ENDDO
	DECREMENTAR(@POSMENU)
	DO WHILE (LEFT(PALAB[POSMENU], 1)=="~")
		DECREMENTAR(@POSMENU)
	ENDDO

	IF (!SUBMENU)
		DO PINTAMENU
	ELSE
		RESTAURAR()
		INCREMENTAR(@POSMENU)
		IF (LEFT(PALAB[POSMENU], 1)=="~")
			POSMENU=POSMENU+POSSUB[POSMENU-1]
			DO PINTAMENU
			DO PINTASUBMENU
		ELSE
                        ACTUAL="ú"
			DECREMENTAR(@POSMENU)
			DO PINTAMENU
		ENDIF
	ENDIF

      CASE TECLA==24 // ABAJO
	IF (!SUBMENU)
		INCREMENTAR(@POSMENU)
		IF (LEFT(PALAB[POSMENU], 1)=="~")
			SUBMENU=.T.
			POSMENU=POSMENU+POSSUB[POSMENU-1]
			DO PINTASUBMENU
		ELSE
			DECREMENTAR(@POSMENU)
		ENDIF
	ELSE
		INCREMENTAR(@POSMENU)
		IF (LEFT(PALAB[POSMENU], 1)!="~")
			DECREMENTAR(@POSMENU)
			IF (LEFT(PALAB[POSMENU], 1)=="~")
				DO WHILE(LEFT(PALAB[POSMENU], 1)=="~")
					DECREMENTAR(@POSMENU)
				ENDDO
				INCREMENTAR(@POSMENU)
			ENDIF
		ENDIF
		IF (LEFT(PALAB[POSMENU], 1)=="~")
			DO SUBM2
		ENDIF
	ENDIF
      CASE TECLA==5 // ARRIBA
	IF (SUBMENU) .AND. (LEFT(PALAB[POSMENU], 1)=="~")
		DECREMENTAR(@POSMENU)
		IF (LEFT(PALAB[POSMENU], 1)!="~")
			INCREMENTAR(@POSMENU)
			IF (LEFT(PALAB[POSMENU], 1)=="~")
				DO WHILE(LEFT(PALAB[POSMENU], 1)=="~")
					INCREMENTAR(@POSMENU)
				ENDDO
				DECREMENTAR(@POSMENU)
			ENDIF
		ENDIF
		IF (LEFT(PALAB[POSMENU], 1)=="~")
			DO SUBM2
		ENDIF
	ENDIF
      OTHERWISE
	IF (SUBMENU)
		NG=POSMENU
		IF (LEFT(PALAB[NG], 1)=="~")
			DO WHILE (LEFT(PALAB[NG], 1)=="~")
				DECREMENTAR(@NG)
			ENDDO
			INCREMENTAR(@NG)
			TEMPOSMENU=POSMENU
			DO WHILE(LEFT(PALAB[NG], 1)=="~")
				IF (UPPER(CHR(TECLA))==UPPER(RAPIDA[NG]))
					TEMPOSMENU=NG
				ENDIF
				INCREMENTAR(@NG)
			ENDDO
			POSMENU=TEMPOSMENU
			DO SUBM2
		ENDIF
	ELSE
		FOR N=1 TO CNTMNU
			IF (UPPER(CHR(TECLA))==UPPER(RAPIDA[N])) .AND. (LEFT(PALAB[N], 1)!="~")
				L=N
				INCREMENTAR(@L)
				IF (LEFT(PALAB[L], 1)=="~")
					SUBMENU=.T.
					POSMENU=L
					POSMENU=POSMENU+POSSUB[POSMENU-1]
					DO PINTAMENU
					DO PINTASUBMENU
				ELSE
					POSMENU=N
					DO PINTAMENU
				ENDIF
			ENDIF
		NEXT N
	ENDIF
   ENDCASE

   ENDIF
ENDDO

RESTAURAR()
MOUSE_OFF()
RETURN

********************************************************************************
PROCEDURE ACUMMENU
********************************************************************************
PARAMETERS TY, TX, TPOSKEY, TPALABRA, TMENSAJE
TMENSAJE=TMENSAJE //+SPACE(50-LEN(TMENSAJE))
CNTMNU=CNTMNU+1
AADD(YY, TY)
AADD(XX, TX)
AADD(POSK, TPOSKEY)
AADD(PALAB, TPALABRA)
AADD(POSSUB, 0)
AADD(MENSAJE, TMENSAJE)
IF (TPOSKEY!=0)
	AADD(RAPIDA, SUBSTR(TPALABRA, TPOSKEY, 1))
ELSE
	AADD(RAPIDA, "")
ENDIF
RETURN

********************************************************************************
PROCEDURE ACUMV
********************************************************************************
PARAMETERS V1, V2, V3, V4, V5, V6
CNTV=CNTV+1
DO CASE
	CASE V1==1
		CNTBOT=CNTBOT+1
		AADD(VARN1, V1)
		AADD(VARN2, V2)
		AADD(VARN3, V3)
		AADD(VARN4, V4)
		AADD(VARN5, 0) // no
		AADD(VARC1, V5)
		AADD(VARC2, "0")
		AADD(VARC3, "")
	CASE V1==2
		IF GRUP!=V5
			AADD(VARC2, "1")
		ELSE
			AADD(VARC2, "0")
		ENDIF
		GRUP=V5
		AADD(VARN1, V1)
		AADD(VARN2, V2)
		AADD(VARN3, V3)
		AADD(VARN4, V5)
		AADD(VARN5, 0) // no
		AADD(VARC1, V4)
		AADD(VARC3, "")
	CASE V1==3
		AADD(VARN1, V1)
		AADD(VARN2, V2)
		AADD(VARN3, V3)
		AADD(VARN4, 0) // no
		AADD(VARN5, 0) // no
		AADD(VARC1, V4)
		AADD(VARC3, "")
		IF V5==""
			AADD(VARC2, "N/W")
		ELSE
			AADD(VARC2, V5)
		ENDIF
	CASE V1==4
		AADD(VARN1, V1)
		AADD(VARN2, V2)
		AADD(VARN3, V3)
		AADD(VARN4, V4)
		AADD(VARN5, V5)
		IF V6==""
			AADD(VARC1, "N/W")
		ELSE
			AADD(VARC1, V6)
		ENDIF
		AADD(VARC2, "0") // no
		AADD(VARC3, "")
	CASE V1==5
		AADD(VARN1, V1)
		AADD(VARN2, V2)
		AADD(VARN3, V3)
		AADD(VARN4, V5)
		AADD(VARN5, 0) // no
		AADD(VARC1, V4)
		AADD(VARC2, "")
		AADD(VARC3, V6)
	CASE V1==6
		AADD(VARN1, V1)
		AADD(VARN2, V2)
		AADD(VARN3, V3)
		AADD(VARN4, 0) // no
		AADD(VARN5, 0) // no
		AADD(VARC1, V4)
		AADD(VARC2, "0")
		AADD(VARC3, "")
	CASE V1==7
		AADD(VARN1, V1)
		AADD(VARN2, V2)
		AADD(VARN3, V3)
		AADD(VARN4, V4)
		AADD(VARN5, V5)
		IF V6==""
			AADD(VARC1, "N/W")
		ELSE
			AADD(VARC1, V6)
		ENDIF
		AADD(VARC2, "0") // no
		AADD(VARC3, "")
	OTHERWISE
		CLEAR
		SET COLOR TO ("")
		? "Parametros incorrectos"
		QUIT
ENDCASE

********************************************************************************
PROCEDURE SPAUSA
********************************************************************************
   DO WHILE (TECLA==0) .AND. (MOUSE==0)
	   TECLA=INKEY()
	   MOUSE=BOTR()
	   CADHORA2=SUBSTR(TIME(),1,SEGUN)
	   GMT=SUBSTR(TIME(),1,2)
	   NUMGMT=VAL(GMT)
           NUMGMT=NUMGMT+DIFHOR
	   IF NUMGMT>24
		NUMGMT=NUMGMT-24
	   ENDIF
	   IF NUMGMT<0
		NUMGMT=24+NUMGMT
	   ENDIF
	   CADHORA1=""
	   IF NUMGMT<10
		   CADHORA1 = "0" + ALLTRIM(STR(NUMGMT))
	   ELSE
		   CADHORA1 = ALLTRIM(STR(NUMGMT))
	   ENDIF
	   CADHORA1 = SUBSTR(CADHORA1,1,2)
	   CADHORA1 = CADHORA1 + SUBSTR(TIME(),3,SEGUN)
	   IF QUERELOJ=1
		IF !(MONOCROMO)
			HORA2(CADHORA1,SEGUN)
		ELSE
			HORAMONO2(CADHORA1,SEGUN)
		ENDIF
	   ELSE
		IF QUERELOJ=2
			IF !(MONOCROMO)
			   HORA2(CADHORA2,SEGUN)
			ELSE
			   HORAMONO2(CADHORA2,SEGUN)
			ENDIF
		ELSE
			IF !(MONOCROMO)
			   HORA(CADHORA1,CADHORA2,SEGUN)
			ELSE
			   HORAMONO(CADHORA1,CADHORA2,SEGUN)
			ENDIF
		ENDIF
	   ENDIF
	   IF (VARTIEMPO+30<SECONDS())
                DO PROTECT
	   ENDIF
	   IF (POSX()/8!=X_MOUSE) .OR. (POSY()/8!=Y_MOUSE)
		VARTIEMPO=SECONDS()
	   ENDIF
	   X_MOUSE=POSX()/8
	   Y_MOUSE=POSY()/8
   ENDDO
VARTIEMPO=SECONDS()
RETURN

********************************************************************************
PROCEDURE SPAUSA2
********************************************************************************
   DO WHILE (TECLA==0) .AND. (MOUSE==0)
	   TECLA=INKEY()
	   MOUSE=BOTR()
	   CADHORA2=SUBSTR(TIME(),1,SEGUN)
	   GMT=SUBSTR(TIME(),1,2)
	   NUMGMT=VAL(GMT)
           NUMGMT=NUMGMT+DIFHOR
	   IF NUMGMT>24
		NUMGMT=NUMGMT-24
	   ENDIF
	   IF NUMGMT<0
		NUMGMT=24+NUMGMT
	   ENDIF
	   CADHORA1=""
	   IF NUMGMT<10
		   CADHORA1 = "0" + ALLTRIM(STR(NUMGMT))
	   ELSE
		   CADHORA1 = ALLTRIM(STR(NUMGMT))
	   ENDIF
	   CADHORA1 = SUBSTR(CADHORA1,1,2)
	   CADHORA1 = CADHORA1 + SUBSTR(TIME(),3,SEGUN)
	   IF QUERELOJ=1
		IF !(MONOCROMO)
			HORA2(CADHORA1,SEGUN)
		ELSE
			HORAMONO2(CADHORA1,SEGUN)
		ENDIF
	   ELSE
		IF QUERELOJ=2
			IF !(MONOCROMO)
			   HORA2(CADHORA2,SEGUN)
			ELSE
			   HORAMONO2(CADHORA2,SEGUN)
			ENDIF
		ELSE
			IF !(MONOCROMO)
			   HORA(CADHORA1,CADHORA2,SEGUN)
			ELSE
			   HORAMONO(CADHORA1,CADHORA2,SEGUN)
			ENDIF
		ENDIF
	   ENDIF
	   IF (VARTIEMPO+30<SECONDS())
		DO PROTECT
		SET CURSOR ON
	   ENDIF
	   IF (POSX()/8!=X_MOUSE) .OR. (POSY()/8!=Y_MOUSE)
		VARTIEMPO=SECONDS()
	   ENDIF
	   X_MOUSE=POSX()/8
	   Y_MOUSE=POSY()/8
   ENDDO
VARTIEMPO=SECONDS()
RETURN

********************************************************************************
PROCEDURE MANTIENE
********************************************************************************
   MOUSE_ON()
   POSX()
   POSY()
   DO WHILE (BOTR()!=0)
	   SET COLOR TO ("N/W")
	   CADHORA2=SUBSTR(TIME(),1,SEGUN)
	   GMT=SUBSTR(TIME(),1,2)
	   NUMGMT=VAL(GMT)
           NUMGMT=NUMGMT+DIFHOR
	   IF NUMGMT>24
		NUMGMT=NUMGMT-24
	   ENDIF
	   IF NUMGMT<0
		NUMGMT=24+NUMGMT
	   ENDIF
	   CADHORA1=""
	   IF NUMGMT<10
		   CADHORA1 = "0" + ALLTRIM(STR(NUMGMT))
	   ELSE
		   CADHORA1 = ALLTRIM(STR(NUMGMT))
	   ENDIF
	   CADHORA1 = SUBSTR(CADHORA1,1,2)
	   CADHORA1 = CADHORA1 + SUBSTR(TIME(),3,SEGUN)
	   IF QUERELOJ=1
		IF !(MONOCROMO)
			HORA2(CADHORA1,SEGUN)
		ELSE
			HORAMONO2(CADHORA1,SEGUN)
		ENDIF
	   ELSE
		IF QUERELOJ=2
			IF !(MONOCROMO)
			   HORA2(CADHORA2,SEGUN)
			ELSE
			   HORAMONO2(CADHORA2,SEGUN)
			ENDIF
		ELSE
			IF !(MONOCROMO)
			   HORA(CADHORA1,CADHORA2,SEGUN)
			ELSE
			   HORAMONO(CADHORA1,CADHORA2,SEGUN)
			ENDIF
		ENDIF
	   ENDIF
	   IF (VARTIEMPO+30<SECONDS())
		DO PROTECT
	   ENDIF
	   IF (POSX()/8!=X_MOUSE) .OR. (POSY()/8!=Y_MOUSE)
		VARTIEMPO=SECONDS()
	   ENDIF
	   X_MOUSE=POSX()/8
	   Y_MOUSE=POSY()/8
   ENDDO
RETURN

********************************************************************************
PROCEDURE DESACTMENU
********************************************************************************
CONTTEMP=0
DO WHILE (LEFT(PALAB[POSMENU], 1)=="~")
	POSMENU=POSMENU-1
	CONTTEMP=CONTTEMP+1
ENDDO
MOUSE_OFF()
VARCOL="W"

FOR NN=1 TO CNTMNU
	IF (LEFT(PALAB[NN], 1)!="~")
		SET COLOR TO ("N/"+VARCOL)
		@ YY[NN], XX[NN] SAY PALAB[NN]
		IF POSK[NN]!=0
			SET COLOR TO ("R/"+VARCOL)
			@ YY[NN], XX[NN]+POSK[NN]-1 SAY RAPIDA[NN]
		ENDIF
	ENDIF
NEXT NN
MOUSE_ON()
POSMENU=POSMENU+CONTTEMP
RETURN

********************************************************************************
PROCEDURE DIBUJAUND
********************************************************************************
PARAMETERS A
MOUSE_OFF()
SET CURSOR OFF
DIBITEM(1)
VARCOM="W+"
SET COLOR TO ("N/W")
@ VARN3[A]+YVEN1, VARN2[A]+XVEN1 SAY " "
@ VARN3[A]+1+YVEN1, VARN2[A]+1+XVEN1 SAY REPLICATE(" ",LEN(VARC1[A]))
SET COLOR TO (VARCOM+"/G")
@ VARN3[A]+YVEN1, VARN2[A]+XVEN1+1 SAY VARC1[A]
SET COLOR TO ("R/G")
@ VARN3[A]+YVEN1, VARN2[A]+VARN4[A]+XVEN1 SAY SUBSTR(VARC1[A],VARN4[A],1)
MOUSE_ON()
//SET CURSOR ON
RETURN

********************************************************************************
PROCEDURE RESETV
********************************************************************************
PUBLIC BOTON[0],XXB[0],YYB[0],RAPIDAB[0],POSKB[0],RETBOT[0]
PUBLIC CNTBOT
PUBLIC CNTV, POSBOT
PUBLIC VARN1[0],VARN2[0],VARN3[0],VARN4[0],VARN5[0],VARC1[0],VARC2[0],VARC3[0]
MOUSE=0
TECLA=0
RETURN

********************************************************************************
PROCEDURE DIBITEM
********************************************************************************
MOUSE_OFF()
SET CURSOR OFF
PARAMETERS FGH
VARTEM=32
FOR HH=1 TO CNTV
SET COLOR TO ("N/W")
IF VARN1[HH]==FGH
DO CASE
	CASE FGH==1
		VARCOM="N"
		IF POSBOT==HH
			VARCOM="W+"
		ENDIF
		SET COLOR TO (VARCOM+"/G")
		@ VARN3[HH]+YVEN1, VARN2[HH]+XVEN1 SAY SUBSTR(VARC1[HH],1,VARN4[HH]-1)
		@ VARN3[HH]+YVEN1, VARN2[HH]+XVEN1+VARN4[HH] SAY SUBSTR(VARC1[HH],VARN4[HH]+1,LEN(VARC1[HH]))
		SET COLOR TO ("R/G")
		@ VARN3[HH]+YVEN1, VARN2[HH]+VARN4[HH]-1+XVEN1 SAY SUBSTR(VARC1[HH],VARN4[HH],1)
		SET COLOR TO ("W/N")
                @ VARN3[HH]+1+YVEN1, VARN2[HH]+1+XVEN1 SAY REPLICATE("Ü",LEN(VARC1[HH]))
                @ VARN3[HH]+YVEN1, VARN2[HH]+LEN(VARC1[HH])+XVEN1 SAY "ß"
	CASE FGH==2
		SET COLOR TO ("N/W")
		@ VARN3[HH]+YVEN1, VARN2[HH]+XVEN1+4 SAY VARC1[HH]
		IF POSBOT==HH
			SET COLOR TO ("W+/W")
		ENDIF
		IF VARC2[HH]="1"
			VARTEM=7
		ELSE
			VARTEM=32
		ENDIF
		@ VARN3[HH]+YVEN1, VARN2[HH]+XVEN1 SAY "("+CHR(VARTEM)+")"
	CASE FGH==3
		SET COLOR TO (VARC2[HH])
		@ VARN3[HH]+YVEN1, VARN2[HH]+XVEN1 SAY VARC1[HH]
	CASE FGH==4
		SET COLOR TO (VARC1[HH])
		@ VARN3[HH]+YVEN1, VARN2[HH]+XVEN1 TO VARN5[HH]+YVEN1, VARN4[HH]+XVEN1
	CASE FGH==5
		SET COLOR TO ("W+/B")
               	@ VARN3[HH]+YVEN1, VARN2[HH]+XVEN1 SAY VARC2[HH]+SPACE(LEN(VARC1[HH])-LEN(VARC2[HH]))
	CASE FGH==6
		SET COLOR TO ("N/W")
		@ VARN3[HH]+YVEN1, VARN2[HH]+XVEN1 SAY VARC1[HH]
		IF POSBOT==HH
			SET COLOR TO ("W+/W")
		ENDIF
		IF VARC2[HH]="1"
			@ VARN3[HH]+YVEN1, VARN2[HH]+XVEN1+LEN(VARC1[HH])+1 SAY "[X]"
		ELSE
			@ VARN3[HH]+YVEN1, VARN2[HH]+XVEN1+LEN(VARC1[HH])+1 SAY "[ ]"
		ENDIF
	CASE VARN1[HH]==7
		SET COLOR TO (VARC1[HH])
		@ VARN3[HH]+YVEN1, VARN2[HH]+XVEN1 CLEAR TO VARN5[HH]+YVEN1, VARN4[HH]+XVEN1
ENDCASE
ENDIF
NEXT HH
//SET CURSOR ON
MOUSE_ON()
RETURN

********************************************************************************
PROCEDURE DIBTODO
********************************************************************************
FOR HH=1 TO CNTV
SET CURSOR OFF
SET COLOR TO ("N/W")
DO CASE
	CASE VARN1[HH]==1
		VARCOM="N"
		IF POSBOT==HH
			VARCOM="W+"
		ENDIF
		SET COLOR TO (VARCOM+"/G")
		@ VARN3[HH]+YVEN1, VARN2[HH]+XVEN1 SAY SUBSTR(VARC1[HH],1,VARN4[HH]-1)
		@ VARN3[HH]+YVEN1, VARN2[HH]+XVEN1+VARN4[HH] SAY SUBSTR(VARC1[HH],VARN4[HH]+1,LEN(VARC1[HH]))
		SET COLOR TO ("R/G")
		@ VARN3[HH]+YVEN1, VARN2[HH]+VARN4[HH]-1+XVEN1 SAY SUBSTR(VARC1[HH],VARN4[HH],1)
		SET COLOR TO ("W/N")
                @ VARN3[HH]+1+YVEN1, VARN2[HH]+1+XVEN1 SAY REPLICATE("Ü",LEN(VARC1[HH]))
                @ VARN3[HH]+YVEN1, VARN2[HH]+LEN(VARC1[HH])+XVEN1 SAY "ß"
	CASE VARN1[HH]==2
		SET COLOR TO ("N/W")
		@ VARN3[HH]+YVEN1, VARN2[HH]+XVEN1+4 SAY VARC1[HH]
		IF POSBOT==HH
			SET COLOR TO ("W+/W")
		ENDIF
		IF VARC2[HH]="1"
			VARTEM=7
		ELSE
			VARTEM=32
		ENDIF
		@ VARN3[HH]+YVEN1, VARN2[HH]+XVEN1 SAY "("+CHR(VARTEM)+")"
//		@ VARN3[HH]+YVEN1, VARN2[HH]+XVEN1 SAY "( ) " + VARC1[HH]
	CASE VARN1[HH]==3
		SET COLOR TO (VARC2[HH])
		@ VARN3[HH]+YVEN1, VARN2[HH]+XVEN1 SAY VARC1[HH]
	CASE VARN1[HH]==4
		SET COLOR TO (VARC1[HH])
		@ VARN3[HH]+YVEN1, VARN2[HH]+XVEN1 TO VARN5[HH]+YVEN1, VARN4[HH]+XVEN1
	CASE VARN1[HH]==5
		SET COLOR TO ("W+/B")
               	@ VARN3[HH]+YVEN1, VARN2[HH]+XVEN1 SAY VARC2[HH]+SPACE(LEN(VARC1[HH])-LEN(VARC2[HH]))
	CASE VARN1[HH]==6
		SET COLOR TO ("N/W")
		@ VARN3[HH]+YVEN1, VARN2[HH]+XVEN1 SAY VARC1[HH]
		IF POSBOT==HH
			SET COLOR TO ("W+/W")
		ENDIF
		IF VARC2[HH]="1"
			@ VARN3[HH]+YVEN1, VARN2[HH]+XVEN1+LEN(VARC1[HH])+1 SAY "[X]"
		ELSE
			@ VARN3[HH]+YVEN1, VARN2[HH]+XVEN1+LEN(VARC1[HH])+1 SAY "[ ]"
		ENDIF
//                @ VARN3[HH]+YVEN1, VARN2[HH]+XVEN1 SAY VARC1[HH] + " [ ]"
	CASE VARN1[HH]==7
		SET COLOR TO (VARC1[HH])
		@ VARN3[HH]+YVEN1, VARN2[HH]+XVEN1 CLEAR TO VARN5[HH]+YVEN1, VARN4[HH]+XVEN1
ENDCASE
NEXT HH
//SET CURSOR ON
RETURN

********************************************************************************
PROCEDURE EDITCAMPO
********************************************************************************
SIGUE=.T.
CADENA=VARC2[POSBOT]
PUNTO=0
IF AT(".",CADENA)!=0
	PUNTO=1
ENDIF
TECLA=0
MOUSE=0
POSCUR=0
XTMP=0
YTMP=0
DIBITEM(2)
DIBITEM(6)
SET COLOR TO ("W+/B")
MOUSE_OFF()
@ VARN3[POSBOT]+YVEN1, VARN2[POSBOT]+XVEN1 SAY CADENA
@ VARN3[POSBOT]+YVEN1, VARN2[POSBOT]+XVEN1+POSCUR SAY ""
SET CURSOR ON
MOUSE_ON()
MANTIENE()
DO WHILE (SIGUE)
	TECLA=0
	MOUSE=0
	DO WHILE (TECLA==0) .AND. (MOUSE==0)
	   TECLA=INKEY()
	   MOUSE=BOTR()
	   CADHORA2=SUBSTR(TIME(),1,SEGUN)
	   GMT=SUBSTR(TIME(),1,2)
	   NUMGMT=VAL(GMT)
           NUMGMT=NUMGMT+DIFHOR
	   IF NUMGMT>24
		NUMGMT=NUMGMT-24
	   ENDIF
	   IF NUMGMT<0
		NUMGMT=24+NUMGMT
	   ENDIF
	   CADHORA1=""
	   IF NUMGMT<10
		   CADHORA1 = "0" + ALLTRIM(STR(NUMGMT))
	   ELSE
		   CADHORA1 = ALLTRIM(STR(NUMGMT))
	   ENDIF
	   CADHORA1 = SUBSTR(CADHORA1,1,2)
	   CADHORA1 = CADHORA1 + SUBSTR(TIME(),3,SEGUN)
	   IF QUERELOJ=1
		IF !(MONOCROMO)
			HORA2(CADHORA1,SEGUN)
		ELSE
			HORAMONO2(CADHORA1,SEGUN)
		ENDIF
	   ELSE
		IF QUERELOJ=2
			IF !(MONOCROMO)
			   HORA2(CADHORA2,SEGUN)
			ELSE
			   HORAMONO2(CADHORA2,SEGUN)
			ENDIF
		ELSE
			IF !(MONOCROMO)
			   HORA(CADHORA1,CADHORA2,SEGUN)
			ELSE
			   HORAMONO(CADHORA1,CADHORA2,SEGUN)
			ENDIF
		ENDIF
	   ENDIF
	   IF (VARTIEMPO+30<SECONDS())
		SET CURSOR OFF
		XTMP=COL()
		YTMP=ROW()
		DO PROTECT
		SETPOS(YTMP,XTMP)
		SET CURSOR ON
	   ENDIF
	   IF (POSX()/8!=X_MOUSE) .OR. (POSY()/8!=Y_MOUSE)
		VARTIEMPO=SECONDS()
	   ENDIF
	   X_MOUSE=POSX()/8
	   Y_MOUSE=POSY()/8
	ENDDO
	VARTIEMPO=SECONDS()
	IF (TECLA!=0)
	DO CASE
		CASE TECLA==27
			TECLA=0
			KEYBOARD CHR(27)
			SET CURSOR OFF
			RETURN
		CASE TECLA==9
			VARC2[POSBOT]=CADENA
			IF (VARC3[POSBOT]==NIL) .OR. (VARC3[POSBOT]!=NIL .AND. &(VARC3[POSBOT]))
					KEYBOARD CHR(9)
					SET CURSOR OFF
					RETURN
			ENDIF
		CASE TECLA==24
			VARC2[POSBOT]=CADENA
			IF (VARC3[POSBOT]==NIL) .OR. (VARC3[POSBOT]!=NIL .AND. &(VARC3[POSBOT]))
					KEYBOARD CHR(9)
					SET CURSOR OFF
					RETURN
			ENDIF
		CASE TECLA=271
			VARC2[POSBOT]=CADENA
			IF (VARC3[POSBOT]==NIL) .OR. (VARC3[POSBOT]!=NIL .AND. &(VARC3[POSBOT]))
				POSBOT=POSBOT-1
				IF POSBOT<1
					POSBOT=CNTV
				ENDIF
				DO WHILE (VARN1[POSBOT]==3 .OR. VARN1[POSBOT]==4 .OR. VARN1[POSBOT]==7)
					POSBOT=POSBOT-1
					IF POSBOT<1
						POSBOT=CNTV
					ENDIF
				ENDDO
				POSBOT=POSBOT-1
				IF POSBOT<1
					POSBOT=CNTV
				ENDIF
				DO WHILE (VARN1[POSBOT]==3 .OR. VARN1[POSBOT]==4 .OR. VARN1[POSBOT]==7)
					POSBOT=POSBOT-1
					IF POSBOT<1
						POSBOT=CNTV
					ENDIF
				ENDDO
				KEYBOARD CHR(9)
				SET CURSOR OFF
				RETURN
			ENDIF
		CASE TECLA=5
			VARC2[POSBOT]=CADENA
			IF (VARC3[POSBOT]==NIL) .OR. (VARC3[POSBOT]!=NIL .AND. &(VARC3[POSBOT]))
			POSBOT=POSBOT-1
			IF POSBOT<1
				POSBOT=CNTV
			ENDIF
			DO WHILE (VARN1[POSBOT]==3 .OR. VARN1[POSBOT]==4 .OR. VARN1[POSBOT]==7)
				POSBOT=POSBOT-1
				IF POSBOT<1
					POSBOT=CNTV
				ENDIF
			ENDDO
			POSBOT=POSBOT-1
			IF POSBOT<1
				POSBOT=CNTV
			ENDIF
			DO WHILE (VARN1[POSBOT]==3 .OR. VARN1[POSBOT]==4 .OR. VARN1[POSBOT]==7)
				POSBOT=POSBOT-1
				IF POSBOT<1
					POSBOT=CNTV
				ENDIF
			ENDDO
			KEYBOARD CHR(9)
			SET CURSOR OFF
			RETURN
			ENDIF
		CASE TECLA==13
			VARC2[POSBOT]=CADENA
			IF (VARC3[POSBOT]==NIL) .OR. (VARC3[POSBOT]!=NIL .AND. &(VARC3[POSBOT]))
				KEYBOARD CHR(9)
				SET CURSOR OFF
				RETURN
			ENDIF
		CASE TECLA==8
			IF (POSCUR==0) .AND. (VARN4[POSBOT]==1)
				TECLA=9
				VARC2[POSBOT]=CADENA
				POSBOT=POSBOT-1
				IF POSBOT<1
					POSBOT=CNTV
				ENDIF
				DO WHILE (VARN1[POSBOT]==3 .OR. VARN1[POSBOT]==4 .OR. VARN1[POSBOT]==7)
					POSBOT=POSBOT-1
					IF POSBOT<1
						POSBOT=CNTV
					ENDIF
				ENDDO
				POSBOT=POSBOT-1
				IF POSBOT<1
					POSBOT=CNTV
				ENDIF
				DO WHILE (VARN1[POSBOT]==3 .OR. VARN1[POSBOT]==4 .OR. VARN1[POSBOT]==7)
					POSBOT=POSBOT-1
					IF POSBOT<1
						POSBOT=CNTV
					ENDIF
				ENDDO
				KEYBOARD CHR(9)
				SET CURSOR OFF
				RETURN
			ENDIF
			IF (LEN(CADENA)>0) .AND. (POSCUR>0)
				CADENA=STUFF(CADENA,POSCUR,1,"")
				POSCUR=POSCUR-1
				SET COLOR TO ("W+/B")
				MOUSE_OFF()
				@ VARN3[POSBOT]+YVEN1, VARN2[POSBOT]+XVEN1 SAY CADENA + " "// PICTURE VARC1[POSBOT]
				@ VARN3[POSBOT]+YVEN1, VARN2[POSBOT]+XVEN1+POSCUR SAY ""
				MOUSE_ON()
			ENDIF
			PUNTO=0
			IF AT(".",CADENA)!=0
				PUNTO=1
			ENDIF
		CASE TECLA==4  //DERECHA
			POSCUR=POSCUR+1
			IF POSCUR>LEN(VARC1[POSBOT])-1
				POSCUR=LEN(VARC1[POSBOT])-1
			ENDIF
			IF POSCUR>LEN(CADENA)
				POSCUR=LEN(CADENA)
			ENDIF
			MOUSE_OFF()
			@ VARN3[POSBOT]+YVEN1, VARN2[POSBOT]+XVEN1+POSCUR SAY ""
			MOUSE_ON()
		CASE TECLA==19 //IZQUIERDA
			POSCUR=POSCUR-1
			IF POSCUR<0
				POSCUR=0
			ENDIF
			MOUSE_OFF()
			@ VARN3[POSBOT]+YVEN1, VARN2[POSBOT]+XVEN1+POSCUR SAY ""
			MOUSE_ON()
		CASE TECLA==1  //HOME
			POSCUR=0
			MOUSE_OFF()
			@ VARN3[POSBOT]+YVEN1, VARN2[POSBOT]+XVEN1+POSCUR SAY ""
			MOUSE_ON()
		CASE TECLA==6  //END
			POSCUR=LEN(VARC1[POSBOT])-1
			IF POSCUR>LEN(CADENA)
				POSCUR=LEN(CADENA)
			ENDIF
			MOUSE_OFF()
			@ VARN3[POSBOT]+YVEN1, VARN2[POSBOT]+XVEN1+POSCUR SAY ""
			MOUSE_ON()
		OTHERWISE
			IF (SUBSTR(VARC1[POSBOT],POSCUR+1,1)=="9")
				IF ((TECLA>=48) .AND. (TECLA<=57)) .OR. ((TECLA==46) .AND. (PUNTO==0))
					IF TECLA=46
						PUNTO=1
					ENDIF
					CADENA=STUFF(CADENA,POSCUR+1,1,CHR(TECLA))
					POSCUR=POSCUR+1
				ENDIF
			ELSE
				IF (SUBSTR(VARC1[POSBOT],POSCUR+1,1)=="A")
				IF (TECLA>=32) .AND. (TECLA<=255)
					CADENA=STUFF(CADENA,POSCUR+1,1,CHR(TECLA))
					POSCUR=POSCUR+1
				ENDIF
				ENDIF
			ENDIF
			IF (POSCUR>=LEN(VARC1[POSBOT]))
				MOUSE_OFF()
				@ VARN3[POSBOT]+YVEN1, VARN2[POSBOT]+XVEN1 SAY CADENA
				MOUSE_ON()
				VARC2[POSBOT]=CADENA
				IF (VARC3[POSBOT]==NIL) .OR. (VARC3[POSBOT]!=NIL .AND. &(VARC3[POSBOT]))
					KEYBOARD CHR(9)
					SET CURSOR OFF
					RETURN
				ENDIF
				POSCUR=POSCUR-1
			ENDIF
			SET COLOR TO ("W+/B")
			MOUSE_OFF()
			@ VARN3[POSBOT]+YVEN1, VARN2[POSBOT]+XVEN1 SAY CADENA
			@ VARN3[POSBOT]+YVEN1, VARN2[POSBOT]+XVEN1+POSCUR SAY ""
			MOUSE_ON()
	ENDCASE
	ELSE
		MOUSE=1
		VARC2[POSBOT]=CADENA
		IF (VARC3[POSBOT]==NIL) .OR. (VARC3[POSBOT]!=NIL .AND. &(VARC3[POSBOT]))
			SET CURSOR OFF
			RETURN
		ENDIF
	ENDIF
ENDDO
MOUSE_OFF()
SET CURSOR OFF
RETURN

********************************************************************************
PROCEDURE CAMPOATRAS
********************************************************************************
POSBOT=POSBOT-1
IF POSBOT<1
	POSBOT=CNTV
ENDIF
DO WHILE (VARN1[POSBOT]!=1 .AND. VARN1[POSBOT]!=2 .AND. VARN1[POSBOT]!=5 .AND. VARN1[POSBOT]!=6)
	POSBOT=POSBOT-1
	IF POSBOT<1
		POSBOT=CNTV
	ENDIF
ENDDO
DO CASE
	CASE VARN1[POSBOT]==1
		DIBITEM(1)
		DIBITEM(2)
		DIBITEM(6)
	CASE VARN1[POSBOT]==2
		DIBITEM(2)
		DIBITEM(6)
	CASE VARN1[POSBOT]==5
		DIBITEM(2)
		DIBITEM(6)
		EDITCAMPO()
	CASE VARN1[POSBOT]==6
		DIBITEM(2)
		DIBITEM(6)
ENDCASE
RETURN

********************************************************************************
FUNCTION HORAMAXI
********************************************************************************
IF VAL(VARC2[POSBOT])>24
	TONE(300,1)
	RETURN .F.
ENDIF
IF (VAL(VARC2[POSBOT])<10) .AND. (LEN(ALLTRIM(VARC2[POSBOT]))<=1)
	IF (LEN(ALLTRIM(VARC2[POSBOT]))==0)
		VARC2[POSBOT]="00"
	ELSE
		VARC2[POSBOT]="0"+ALLTRIM(VARC2[POSBOT])
	ENDIF
	SET COLOR TO ("W+/B")
        MOUSE_OFF()
        @ VARN3[POSBOT]+YVEN1, VARN2[POSBOT]+XVEN1 SAY VARC2[POSBOT]
        MOUSE_ON()
ENDIF
RETURN .T.

********************************************************************************
FUNCTION MINUMAXI
********************************************************************************
IF VAL(VARC2[POSBOT])>59
	TONE(300,1)
	RETURN .F.
ENDIF
IF (VAL(VARC2[POSBOT])<10) .AND. (LEN(ALLTRIM(VARC2[POSBOT]))<=1)
	IF (LEN(ALLTRIM(VARC2[POSBOT]))==0)
		VARC2[POSBOT]="00"
	ELSE
		VARC2[POSBOT]="0"+ALLTRIM(VARC2[POSBOT])
	ENDIF
	SET COLOR TO ("W+/B")
        MOUSE_OFF()
        @ VARN3[POSBOT]+YVEN1, VARN2[POSBOT]+XVEN1 SAY VARC2[POSBOT]
        MOUSE_ON()
ENDIF
RETURN .T.

********************************************************************************
FUNCTION DIAMAXI
********************************************************************************
IF VAL(VARC2[POSBOT])>31
	TONE(300,1)
	RETURN .F.
ENDIF
IF (VAL(VARC2[POSBOT])<10) .AND. (LEN(ALLTRIM(VARC2[POSBOT]))<=1)
	IF (LEN(ALLTRIM(VARC2[POSBOT]))==0)
		VARC2[POSBOT]="00"
	ELSE
		VARC2[POSBOT]="0"+ALLTRIM(VARC2[POSBOT])
	ENDIF
	SET COLOR TO ("W+/B")
        MOUSE_OFF()
        @ VARN3[POSBOT]+YVEN1, VARN2[POSBOT]+XVEN1 SAY VARC2[POSBOT]
        MOUSE_ON()
ENDIF
RETURN .T.

********************************************************************************
FUNCTION MESMAXI
********************************************************************************
IF VAL(VARC2[POSBOT])>12
	TONE(300,1)
	RETURN .F.
ENDIF
IF (VAL(VARC2[POSBOT])<10) .AND. (LEN(ALLTRIM(VARC2[POSBOT]))<=1)
	IF (LEN(ALLTRIM(VARC2[POSBOT]))==0)
		VARC2[POSBOT]="00"
	ELSE
		VARC2[POSBOT]="0"+ALLTRIM(VARC2[POSBOT])
	ENDIF
	SET COLOR TO ("W+/B")
        MOUSE_OFF()
        @ VARN3[POSBOT]+YVEN1, VARN2[POSBOT]+XVEN1 SAY VARC2[POSBOT]
        MOUSE_ON()
ENDIF
RETURN .T.

********************************************************************************
FUNCTION DISTIN
********************************************************************************
IF VARC2[POSBOT]==""
ELSE
SELECT 1
XORDEN=INDEXORD()
XPOS=RECNO()
SET ORDER TO 1
CDIS=VARC2[POSBOT]
CONTCOM=1
SEEKEXACT(CDIS)
IF FOUND()
	DO WHILE(ALLTRIM(DISTINTIVA)==ALLTRIM(CDIS))
		CONTCOM=CONTCOM+1
		SKIP
	ENDDO
	SKIP -1
        VARC2[33]=NOMBRES
        VARC2[34]=APELLIDO
        VARC2[35]=DOMICILIO
        VARC2[36]=LOCALIDAD
        VARC2[37]=PROVINCIA
        VARC2[38]=PAIS
        DIBITEM(5)
ELSE
        VARC2[33]=""
        VARC2[34]=""
        VARC2[35]=""
        VARC2[36]=""
        VARC2[37]=""
        VARC2[38]=""
	SELECT 3
	SET ORDER TO 1
	CDIS=SUBSTR(ALLTRIM(CDIS),1,3)
	SEEK(SUBSTR(ALLTRIM(CDIS),1,1))
	IF FOUND()
	   SIGUE=.T.
	   DO WHILE (SUBSTR(ALLTRIM(CDIS),1,1)==SUBSTR(ALLTRIM(DESDE),1,1)) .AND. (SIGUE==.T.)
		IF (ALLTRIM(CDIS)>=ALLTRIM(DESDE)) .AND. (ALLTRIM(CDIS)<=ALLTRIM(HASTA))
			VARC2[37]=PROVINCIA
			VARC2[38]=PAIS
			SIGUE=.F.
		ENDIF
		SKIP
	   ENDDO
	ENDIF
        DIBITEM(5)
//	SET SOFTSEEK OFF
	SELECT 1
ENDIF
SET ORDER TO 8
GO BOTTOM
NUMCOM=COMUN+1
SET COLOR TO ("W+/W")
SET DECIMALS TO 0
@ VARN3[POSBOT]+YVEN1, VARN2[POSBOT]+XVEN1+12 SAY "N§ Comunicado:"+PADL(NUMCOM,5,"0")+" / Cant.:"+PADL(CONTCOM,3,"0")
SET DECIMALS TO 1
SET ORDER TO XORDEN
GO XPOS
ENDIF
RETURN .T.

********************************************************************************
FUNCTION DISTIN2
********************************************************************************
SELECT 1
IF VARC2[POSBOT]==DISTINTIVA
	CONTCOM=VECES
ELSE
XORDEN=INDEXORD()
XPOS=RECNO()
SET ORDER TO 1
CDIS=VARC2[POSBOT]
SEEK(CDIS)
IF FOUND()
	DO WHILE(ALLTRIM(DISTINTIVA)==ALLTRIM(CDIS))
		SKIP
	ENDDO
	SKIP -1
	CONTCOM=VECES+1
ELSE
	CONTCOM=1
ENDIF
SET ORDER TO XORDEN
GO XPOS
ENDIF
SET COLOR TO ("W+/W")
SET DECIMALS TO 0
@ VARN3[POSBOT]+YVEN1, VARN2[POSBOT]+XVEN1+12 SAY "N§ Comunicado:"+PADL(NUMCOM,5,"0")+" / Cant.:"+PADL(CONTCOM,3,"0")
SET DECIMALS TO 1
RETURN .T.

**********************************
FUNCTION BUSCAR
**********************************
//PARAMETERS NUMERO
CNOMBRE=SPACE(50)
CNOMBRE=ALLTRIM(CNOMBRE)
POSBAR=1
TECLA=0
NO=0
LIM=1
SELECT 1
GO TOP
DECLARE LISTA[11]
FRE=1
RESETV()
CNTBOT=0
CNTV=0
POSBOT=1
TECLA=0
MOUSE=0
XQSL_ENVI="NO"
XQSL_RECI="NO"
CADTIT1="Comun-Veces³Distintiva³Fecha   ³H.Ini³H.Fin³Banda³Nombres                       ³Apellido            ³Domicilio           ³Localidad           ³Provincia           ³Pais                ³RSTRX³RSTTX³"
CADTIT1=CADTIT1+"QE³QR³Mod³Nota 1                                                           ³Nota 2                                                           "

CADTIT2="ÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÅÄÄÄÄÄÅÄÄÄÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÅÄÄÄÄÄÅ"
CADTIT2=CADTIT2+"ÄÄÅÄÄÅÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ"
//   SAVE SCREEN
   SELECT 2
   GO 3
   XVEN1=X1
   YVEN1=Y1
   XVEN2=X2
   YVEN2=Y2
   SELECT 1
   ACUMV(1, ((XVEN2-XVEN1)/2)-20, 13, 5, "    Ok    ")
   ACUMV(1, ((XVEN2-XVEN1)/2)+10, 13, 3, "  M s...  ")
   DESACTMENU()
   PANT()
   SUPERFF=SAVESCREEN(0,0,23,79)
//   LEEFF()
   DIBVEN1()
   SET COLOR TO ("W+/B")
//   MOUSE_OFF()
   SET CURSOR OFF
   @ YVEN2-4, XVEN1+3 SAY SPACE(70)
   SET CURSOR ON
   SET COLOR TO N/W
   @ YVEN1+2, XVEN1+3 SAY SUBSTR(CADTIT1,LIM,70)
   @ YVEN1+3, XVEN1+3 SAY SUBSTR(CADTIT2,LIM,70)
   MOUSE_ON()
   FOR A=1 TO 6
   IF A==POSBAR
      SET COLOR TO ("N/BG")
//      SET COLOR TO ("W+/W")
   ENDIF
   XQSL_ENVI="NO"
   XQSL_RECI="NO"
   IF VAL(QSL_ENVI)==1
	 XQSL_ENVI="SI"
   ENDIF
   IF VAL(QSL_RECI)==1
	 XQSL_RECI="SI"
   ENDIF
   SET DECIMALS TO 0
   LISTA[A]=PADL(COMUN,5,"0")+"-"+PADL(VECES,3,"0")+"  ³"+DISTINTIVA+"³"+DTOC(FECHA)+"³"+HORA_INICI+"³"+HORA_FINAL+"³"+STR(BANDA)+"³"+NOMBRES+"³"+APELLIDO+"³"+DOMICILIO+"³"+LOCALIDAD+"³"+PROVINCIA+"³"+PAIS+"³"+RST_RX+"³"+RST_TX+"³"+XQSL_ENVI+"³"+XQSL_RECI+"³"+MODO+"³"+NOTA_1+"³"+NOTA_2
   SET DECIMALS TO 1
   IF !EOF()
   MOUSE_OFF()
   @ YVEN1+A+3, XVEN1+3 SAY SUBSTR(LISTA[A],LIM,70) //DISTINTIVA
   MOUSE_ON()
   ENDIF
   SET COLOR TO N/W
   SKIP
   NEXT
   IF EOF()
	SKIP-1
   ENDIF
   SET COLOR TO ("W+/B")
   @ YVEN2-4, XVEN1+3 SAY LTRIM(CNOMBRE) + " "
   @ YVEN2-4, XVEN1+3+LEN(LTRIM(CNOMBRE)) SAY ""
   GO TOP
   TECLA=0
   LIMITE=6
   IF RECCOUNT()<7
      LIMITE=RECCOUNT()
   ENDIF
   MANTIENE()
   
   DO WHILE (TECLA!=27)
      MOUSE=0
      TECLA=0
      X_MOUAUX1=0
      Y_MOUAUX1=0
      SPAUSA2()
   IF (MOUSE!=0)
   SET CURSOR OFF
   FOR G=1 TO CNTV
	IF (VARN1[G]==1) .AND. (MOUSE==1) .AND. (X_MOUSE>=VARN2[G]+XVEN1) .AND. (X_MOUSE<=VARN2[G]+LEN(VARC1[G])-1+XVEN1) .AND. (Y_MOUSE==VARN3[G]+YVEN1)
		POSBOT=G
		DIBUJAUND(G)
		MANTIENE()
		MOUSE=0
		IF (X_MOUSE>=VARN2[G]+XVEN1) .AND. (X_MOUSE<=VARN2[G]+LEN(VARC1[G])-1+XVEN1) .AND. (Y_MOUSE==VARN3[G]+YVEN1)
			IF POSBAR>1
				SKIP POSBAR-1
			ENDIF
			CNOMBRE=""
			MOUSE_OFF()
			SET CURSOR OFF
			SET COLOR TO ("W+/B")
			@ YVEN2-4, XVEN1+3 SAY SPACE(70)
			FRE=G
			DIBITEM(1)
			DIBITEM(2)
			RETURN (0)
		ENDIF
		DIBITEM(1)
		DIBITEM(2)
	ENDIF
   NEXT G
   SET CURSOR ON
   SETPOS(YVEN2-4, XVEN1+3+LEN(CNOMBRE))
   IF (Y_MOUSE=YVEN1) .AND. (X_MOUSE>XVEN1) .AND. (X_MOUSE<XVEN2) .AND. (MOUSE==1)
	SET CURSOR OFF
	VENTF=SAVESCREEN(YVEN1+1,XVEN1+1,YVEN2-1,XVEN2-1)
	IF X_MOUSE=XVEN1+2
		MOUSE_OFF()
		FRE=0
		RETURN (0)
	ENDIF
	XREF1=X_MOUSE-XVEN1
	XREF2=XVEN2-X_MOUSE
	YREF=YVEN2-YVEN1
	DO WHILE (MOUSE!=0)
//           SET CURSOR OFF
	   MOUSE=BOTR()
	   CADHORA2=SUBSTR(TIME(),1,SEGUN)
	   GMT=SUBSTR(TIME(),1,2)
	   NUMGMT=VAL(GMT)
           NUMGMT=NUMGMT+DIFHOR
	   IF NUMGMT>24
		NUMGMT=NUMGMT-24
	   ENDIF
	   IF NUMGMT<0
		NUMGMT=24+NUMGMT
	   ENDIF
	   CADHORA1=""
	   IF NUMGMT<10
		   CADHORA1 = "0" + ALLTRIM(STR(NUMGMT))
	   ELSE
		   CADHORA1 = ALLTRIM(STR(NUMGMT))
	   ENDIF
	   CADHORA1 = SUBSTR(CADHORA1,1,2)
	   CADHORA1 = CADHORA1 + SUBSTR(TIME(),3,SEGUN)
	   IF QUERELOJ=1
		IF !(MONOCROMO)
			HORA2(CADHORA1,SEGUN)
		ELSE
			HORAMONO2(CADHORA1,SEGUN)
		ENDIF
	   ELSE
		IF QUERELOJ=2
			IF !(MONOCROMO)
			   HORA2(CADHORA2,SEGUN)
			ELSE
			   HORAMONO2(CADHORA2,SEGUN)
			ENDIF
		ELSE
			IF !(MONOCROMO)
        	           HORA(CADHORA1,CADHORA2,SEGUN)
			ELSE
        	           HORAMONO(CADHORA1,CADHORA2,SEGUN)
			ENDIF
		ENDIF
	   ENDIF
	   IF (VARTIEMPO+30<SECONDS())
		SET CURSOR OFF
		DO PROTECT
		SET CURSOR ON
	   ENDIF
	   IF (POSX()/8!=X_MOUSE) .OR. (POSY()/8!=Y_MOUSE)
		VARTIEMPO=SECONDS()
	   ENDIF
	   X_MOUSE=POSX()/8
	   Y_MOUSE=POSY()/8
		SET CURSOR ON
	   IF (X_MOUSE!=POSX()/8) .OR. (Y_MOUSE!=POSY()/8) .OR. (X_MOUAUX1!=X_MOUSE) .OR. (Y_MOUAUX1!=Y_MOUSE)
		X_MOUAUX1=X_MOUSE
		Y_MOUAUX1=Y_MOUSE
		X_MOUSE=POSX()/8
		Y_MOUSE=POSY()/8
		MOUSE=BOTR()
		XVEN1=X_MOUSE-XREF1
		XVEN2=X_MOUSE+XREF2
		YVEN1=Y_MOUSE
		YVEN2=Y_MOUSE+YREF
		SET CURSOR OFF
		DIBVEN()
		SET CURSOR ON
		SETPOS(YVEN2-4, XVEN1+3+LEN(CNOMBRE))
	   ENDIF
	ENDDO
	SET COLOR TO ("N/W")
	MOUSE_OFF()
	SET CURSOR OFF
	@ YVEN1, XVEN1 TO YVEN2, XVEN2
	@ YVEN1, XVEN1+1 SAY "["+CHR(254)+"]"
	SET CURSOR ON
	MOUSE_ON()
	@ YVEN2-4, XVEN1+3+LEN(CNOMBRE) SAY ""
//      SETPOS(VARTMPA,VARTMPB)
   ENDIF
   MANTIENE()
   ELSE
      SETPOS(YVEN2-4, XVEN1+3+LEN(CNOMBRE))
      MOUSE_OFF()
      DO CASE
      CASE TECLA==4
	SET COLOR TO ("W+/B")
	IF CNOMBRE==""
	ELSE
	SET CURSOR OFF
	@ YVEN2-4, XVEN1+3 SAY SPACE(70)
	SET CURSOR ON
	ENDIF
	CNOMBRE=""
	@ YVEN2-4, XVEN1+3+LEN(CNOMBRE) SAY ""
	IF (LIM==LEN(LISTA[1])-70)
		NO=1
	ENDIF
	LIM=LIM+5
	IF LIM+70>LEN(LISTA[1])
		LIM=LEN(LISTA[1])-70
	ENDIF
      CASE TECLA==19
	SET COLOR TO ("W+/B")
	IF CNOMBRE==""
	ELSE
	SET CURSOR OFF
	@ YVEN2-4, XVEN1+3 SAY SPACE(70)
	SET CURSOR ON
	ENDIF
	CNOMBRE=""
	@ YVEN2-4, XVEN1+3+LEN(CNOMBRE) SAY ""
	IF (LIM==1)
		NO=1
	ENDIF
	LIM=LIM-5
	IF LIM<1
		LIM=1
	ENDIF
      CASE TECLA==8
	 IF (LEN(CNOMBRE)!=0)
	    CNOMBRE=LEFT(CNOMBRE, LEN(CNOMBRE)-1)
	    KEYBOARD(CHR(255))
	 ENDIF
      CASE TECLA==24
	 SET COLOR TO ("W+/B")
	 IF CNOMBRE==""
	 ELSE
	 SET CURSOR OFF
	 @ YVEN2-4, XVEN1+3 SAY SPACE(70)
	 SET CURSOR ON
	 ENDIF
	 CNOMBRE=""
	 IF POSBAR<LIMITE
	    POSBAR=POSBAR+1
	 ELSE
	    SKIP LIMITE
	    IF (EOF())
	       SKIP -LIMITE
	    ELSE
	       SKIP -(LIMITE-1)
	    ENDIF
	 ENDIF
	CASE TECLA=271 // SHIFT+TAB
		CAMPOATRAS()
	CASE TECLA=9 // TAB
		POSBOT=POSBOT+1
		IF POSBOT>CNTV
			POSBOT=1
		ENDIF
		DO WHILE (VARN1[POSBOT]!=1 .AND. VARN1[POSBOT]!=2 .AND. VARN1[POSBOT]!=5 .AND. VARN1[POSBOT]!=6)
			POSBOT=POSBOT+1
			IF POSBOT>CNTV
				POSBOT=1
			ENDIF
		ENDDO
		DO CASE
			CASE VARN1[POSBOT]==1
				DIBITEM(1)
				DIBITEM(2)
				DIBITEM(6)
			CASE VARN1[POSBOT]==2
				DIBITEM(2)
				DIBITEM(6)
			CASE VARN1[POSBOT]==5
				DIBITEM(2)
				DIBITEM(6)
				EDITCAMPO()
			CASE VARN1[POSBOT]==6
				DIBITEM(2)
				DIBITEM(6)
		ENDCASE
      CASE TECLA==13
	 IF POSBAR>1
	    SKIP POSBAR-1
	 ENDIF
//       MOUSE_OFF()
	 DIBUJAUND(POSBOT)
	 FRE=POSBOT
	 RETURN(0)
      CASE TECLA==27
	 IF POSBAR>1
	    SKIP POSBAR-1
	 ENDIF
	 FRE=0
	 RETURN(0)
      CASE TECLA==5
	 SET COLOR TO ("W+/B")
	 IF CNOMBRE==""
	 ELSE
	 SET CURSOR OFF
	 @ YVEN2-4, XVEN1+3 SAY SPACE(70)
	 SET CURSOR ON
	 ENDIF
	 CNOMBRE=""
	 IF POSBAR>1
	    POSBAR=POSBAR-1
	 ELSE
	    SKIP -1
	 ENDIF
      CASE TECLA==18
	 SET COLOR TO ("W+/B")
	 IF CNOMBRE==""
	 ELSE
	 SET CURSOR OFF
	 @ YVEN2-4, XVEN1+3 SAY SPACE(70)
	 SET CURSOR ON
	 ENDIF
	 CNOMBRE=""
	 SKIP -LIMITE
	 IF (BOF())
		POSBAR=1
	 ENDIF
      CASE TECLA==3
	 SET COLOR TO ("W+/B")
	 IF CNOMBRE==""
	 ELSE
	 SET CURSOR OFF
	 @ YVEN2-4, XVEN1+3 SAY SPACE(70)
	 SET CURSOR ON
	 ENDIF
	 CNOMBRE=""
	 SKIP LIMITE*2
	 IF (EOF())
	    SKIP -LIMITE
	    POSBAR=LIMITE
	 ELSE
	    SKIP -LIMITE
	 ENDIF
      CASE TECLA==1
	 POSBAR=1
      CASE TECLA==6
	 POSBAR=LIMITE
      CASE TECLA==31
	 GO TOP
	 POSBAR=1
      CASE TECLA==30
	 GO BOTTOM
	 SKIP -(LIMITE-1)
	 POSBAR=LIMITE
      OTHERWISE
	 IF TECLA!=255
	    CNOMBRE=CNOMBRE+UPPER(CHR(TECLA))
	 ENDIF
	 XXTT=RECNO()
	 XPOSBAR=POSBAR
	 SEEK(CNOMBRE)
	 IF FOUND()
	    POSBAR=1
	    SET CURSOR OFF
	    FOR A=1 TO LIMITE
	    IF (EOF())
	       POSBAR=POSBAR+1
	    ENDIF
	    SKIP
	    NEXT
	    SKIP -LIMITE
	    SET CURSOR ON
	 ELSE
	    IF LEN(CNOMBRE)!=1
	    CNOMBRE=LEFT(CNOMBRE, LEN(CNOMBRE)-1)
	    SEEK(CNOMBRE)
	    POSBAR=1
	    SET CURSOR OFF
	    FOR A=1 TO LIMITE
	    IF (EOF())
	       POSBAR=POSBAR+1
	    ENDIF
	    SKIP
	    NEXT
	    SKIP -LIMITE
	    ELSE
		CNOMBRE=""
		GO XXTT
		POSBAR=XPOSBAR
//	    SET CURSOR OFF
//	    FOR A=1 TO LIMITE
//	    IF (EOF())
//	       POSBAR=POSBAR+1
//	    ENDIF
//	    SKIP
//	    NEXT
//	    SKIP -LIMITE
	    ENDIF
	    NO=1
	 ENDIF
      ENDCASE
      IF NO==0
	 SET CURSOR OFF
	 SET COLOR TO N/W
	 @ YVEN1+2, XVEN1+3 SAY SUBSTR(CADTIT1,LIM,70)
	 @ YVEN1+3, XVEN1+3 SAY SUBSTR(CADTIT2,LIM,70)
	 FOR A=1 TO LIMITE
	 IF A==POSBAR
	    SET COLOR TO ("N/BG")
//	    SET COLOR TO ("W+/W")
	 ENDIF   
	 XQSL_ENVI="NO"
	 XQSL_RECI="NO"
	 IF VAL(QSL_ENVI)==1
		 XQSL_ENVI="SI"
	 ENDIF
	 IF VAL(QSL_RECI)==1
		 XQSL_RECI="SI"
	 ENDIF
	 SET DECIMALS TO 0
	 LISTA[A]=PADL(COMUN,5,"0")+"-"+PADL(VECES,3,"0")+"  ³"+DISTINTIVA+"³"+DTOC(FECHA)+"³"+HORA_INICI+"³"+HORA_FINAL+"³"+STR(BANDA)+"³"+NOMBRES+"³"+APELLIDO+"³"+DOMICILIO+"³"+LOCALIDAD+"³"+PROVINCIA+"³"+PAIS+"³"+RST_RX+"³"+RST_TX+"³"+XQSL_ENVI+"³"+XQSL_RECI+"³"+MODO+"³"+NOTA_1+"³"+NOTA_2
	 SET DECIMALS TO 1
	 @ YVEN1+A+3, XVEN1+3 SAY SUBSTR(LISTA[A],LIM,70)
	 SET COLOR TO N/W
	 SKIP
	 NEXT
	 SKIP -LIMITE
	 SET CURSOR ON
      ENDIF
      NO=0
      SET CURSOR OFF
      SET COLOR TO ("W+/B")
      @ YVEN2-4, XVEN1+3 SAY LTRIM(CNOMBRE) + " "
      @ YVEN2-4, XVEN1+3+LEN(LTRIM(CNOMBRE)) SAY ""
      SET CURSOR ON
      SETPOS(YVEN2-4, XVEN1+3+LEN(CNOMBRE))
      MOUSE_ON()
   ENDIF
   ENDDO
//   RESTORE SCREEN

MOUSE_OFF()
FRE=0
RETURN(0)

********************************************************************************
FUNCTION SEEKEXACT(CSEARCH)
********************************************************************************
SEEK PADR(CSEARCH,LEN(&(INDEXKEY(0))))
RETURN (FOUND())

********************************************************************************
FUNCTION BUSCAPRE
********************************************************************************
CNOMBRE=SPACE(53)
CNOMBRE=ALLTRIM(CNOMBRE)
POSBAR=1
TECLA=0
NO=0
LIM=1
SELECT 3
GO TOP
DECLARE LISTA[11]
FRE=1
RESETV()
CNTBOT=0
CNTV=0
POSBOT=1
TECLA=0
MOUSE=0
CADTIT1="Desde³Hasta³Pa¡s                ³Provincia           "
CADTIT2="ÄÄÄÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ"

SELECT 2
GO 5
XVEN1=X1
YVEN1=Y1
XVEN2=X2
YVEN2=Y2
SELECT 3
ACUMV(1, ((XVEN2-XVEN1)/2)-5, 13, 5, "    Ok    ")
DESACTMENU()
PANT()
DIBVEN1()
SET COLOR TO ("W+/B")
SET CURSOR OFF
@ YVEN2-4, XVEN1+3 SAY SPACE(53)
SET CURSOR ON
SET COLOR TO N/W
@ YVEN1+2, XVEN1+3 SAY SUBSTR(CADTIT1,LIM,53)
@ YVEN1+3, XVEN1+3 SAY SUBSTR(CADTIT2,LIM,53)
MOUSE_ON()
FOR A=1 TO 6
IF A==POSBAR
	SET COLOR TO ("N/BG")
ENDIF
   LISTA[A]=" "+DESDE+" ³ "+HASTA+" ³"+PAIS+"³"+PROVINCIA
   IF !EOF()
   MOUSE_OFF()
   @ YVEN1+A+3, XVEN1+3 SAY SUBSTR(LISTA[A],LIM,53) //DISTINTIVA
   MOUSE_ON()
   ENDIF
   SET COLOR TO N/W
   SKIP
   NEXT
   IF EOF()
	SKIP-1
   ENDIF
   SET COLOR TO ("W+/B")
   @ YVEN2-4, XVEN1+3 SAY LTRIM(CNOMBRE) + " "
   @ YVEN2-4, XVEN1+3+LEN(LTRIM(CNOMBRE)) SAY ""
   GO TOP
   TECLA=0
   LIMITE=6
   IF RECCOUNT()<7
      LIMITE=RECCOUNT()
   ENDIF

   MANTIENE()   
   DO WHILE (TECLA!=27)
      MOUSE=0
      TECLA=0
      X_MOUAUX1=0
      Y_MOUAUX1=0
      SPAUSA2()
   IF (MOUSE!=0)
   SET CURSOR OFF
   FOR G=1 TO CNTV
	IF (VARN1[G]==1) .AND. (MOUSE==1) .AND. (X_MOUSE>=VARN2[G]+XVEN1) .AND. (X_MOUSE<=VARN2[G]+LEN(VARC1[G])-1+XVEN1) .AND. (Y_MOUSE==VARN3[G]+YVEN1)
		POSBOT=G
		DIBUJAUND(G)
		MANTIENE()
		MOUSE=0
		IF (X_MOUSE>=VARN2[G]+XVEN1) .AND. (X_MOUSE<=VARN2[G]+LEN(VARC1[G])-1+XVEN1) .AND. (Y_MOUSE==VARN3[G]+YVEN1)
			IF POSBAR>1
				SKIP POSBAR-1
			ENDIF
			CNOMBRE=""
			MOUSE_OFF()
			SET CURSOR OFF
			SET COLOR TO ("W+/B")
                        @ YVEN2-4, XVEN1+3 SAY SPACE(53)
			FRE=G
			DIBITEM(1)
			DIBITEM(2)
			RETURN (0)
		ENDIF
		DIBITEM(1)
		DIBITEM(2)
	ENDIF
   NEXT G
   SET CURSOR ON
   SETPOS(YVEN2-4, XVEN1+3+LEN(CNOMBRE))
   IF (Y_MOUSE=YVEN1) .AND. (X_MOUSE>XVEN1) .AND. (X_MOUSE<XVEN2) .AND. (MOUSE==1)
	SET CURSOR OFF
	VENTF=SAVESCREEN(YVEN1+1,XVEN1+1,YVEN2-1,XVEN2-1)
	IF X_MOUSE=XVEN1+2
		MOUSE_OFF()
		FRE=0
		RETURN (0)
	ENDIF
	XREF1=X_MOUSE-XVEN1
	XREF2=XVEN2-X_MOUSE
	YREF=YVEN2-YVEN1
	DO WHILE (MOUSE!=0)
	   MOUSE=BOTR()
	   CADHORA2=SUBSTR(TIME(),1,SEGUN)
	   GMT=SUBSTR(TIME(),1,2)
	   NUMGMT=VAL(GMT)
           NUMGMT=NUMGMT+DIFHOR
	   IF NUMGMT>24
		NUMGMT=NUMGMT-24
	   ENDIF
	   IF NUMGMT<0
		NUMGMT=24+NUMGMT
	   ENDIF
	   CADHORA1=""
	   IF NUMGMT<10
		   CADHORA1 = "0" + ALLTRIM(STR(NUMGMT))
	   ELSE
		   CADHORA1 = ALLTRIM(STR(NUMGMT))
	   ENDIF
	   CADHORA1 = SUBSTR(CADHORA1,1,2)
	   CADHORA1 = CADHORA1 + SUBSTR(TIME(),3,SEGUN)
	   IF QUERELOJ=1
		IF !(MONOCROMO)
			HORA2(CADHORA1,SEGUN)
		ELSE
			HORAMONO2(CADHORA1,SEGUN)
		ENDIF
	   ELSE
		IF QUERELOJ=2
			IF !(MONOCROMO)
			   HORA2(CADHORA2,SEGUN)
			ELSE
			   HORAMONO2(CADHORA2,SEGUN)
			ENDIF
		ELSE
			IF !(MONOCROMO)
        	           HORA(CADHORA1,CADHORA2,SEGUN)
			ELSE
        	           HORAMONO(CADHORA1,CADHORA2,SEGUN)
			ENDIF
		ENDIF
	   ENDIF
	   IF (VARTIEMPO+30<SECONDS())
		SET CURSOR OFF
		DO PROTECT
		SET CURSOR ON
	   ENDIF
	   IF (POSX()/8!=X_MOUSE) .OR. (POSY()/8!=Y_MOUSE)
		VARTIEMPO=SECONDS()
	   ENDIF
	   X_MOUSE=POSX()/8
	   Y_MOUSE=POSY()/8
		SET CURSOR ON
	   IF (X_MOUSE!=POSX()/8) .OR. (Y_MOUSE!=POSY()/8) .OR. (X_MOUAUX1!=X_MOUSE) .OR. (Y_MOUAUX1!=Y_MOUSE)
		X_MOUAUX1=X_MOUSE
		Y_MOUAUX1=Y_MOUSE
		X_MOUSE=POSX()/8
		Y_MOUSE=POSY()/8
		MOUSE=BOTR()
		XVEN1=X_MOUSE-XREF1
		XVEN2=X_MOUSE+XREF2
		YVEN1=Y_MOUSE
		YVEN2=Y_MOUSE+YREF
		SET CURSOR OFF
		DIBVEN()
		SET CURSOR ON
		SETPOS(YVEN2-4, XVEN1+3+LEN(CNOMBRE))
	   ENDIF
	ENDDO
	SET COLOR TO ("N/W")
	MOUSE_OFF()
	SET CURSOR OFF
	@ YVEN1, XVEN1 TO YVEN2, XVEN2
	@ YVEN1, XVEN1+1 SAY "["+CHR(254)+"]"
	SET CURSOR ON
	MOUSE_ON()
	@ YVEN2-4, XVEN1+3+LEN(CNOMBRE) SAY ""
   ENDIF
   MANTIENE()
   ELSE
      SETPOS(YVEN2-4, XVEN1+3+LEN(CNOMBRE))
      MOUSE_OFF()
      DO CASE
      CASE TECLA==4
	SET COLOR TO ("W+/B")
	IF CNOMBRE==""
	ELSE
	SET CURSOR OFF
        @ YVEN2-4, XVEN1+3 SAY SPACE(53)
	SET CURSOR ON
	ENDIF
	CNOMBRE=""
	@ YVEN2-4, XVEN1+3+LEN(CNOMBRE) SAY ""
        IF (LIM==LEN(LISTA[1])-53)
		NO=1
	ENDIF
	LIM=LIM+5
        IF LIM+53>LEN(LISTA[1])
                LIM=LEN(LISTA[1])-53
	ENDIF
      CASE TECLA==19
	SET COLOR TO ("W+/B")
	IF CNOMBRE==""
	ELSE
	SET CURSOR OFF
        @ YVEN2-4, XVEN1+3 SAY SPACE(53)
	SET CURSOR ON
	ENDIF
	CNOMBRE=""
	@ YVEN2-4, XVEN1+3+LEN(CNOMBRE) SAY ""
	IF (LIM==1)
		NO=1
	ENDIF
	LIM=LIM-5
	IF LIM<1
		LIM=1
	ENDIF
      CASE TECLA==8
	 IF (LEN(CNOMBRE)!=0)
	    CNOMBRE=LEFT(CNOMBRE, LEN(CNOMBRE)-1)
	    KEYBOARD(CHR(255))
	 ENDIF
      CASE TECLA==24
	 SET COLOR TO ("W+/B")
	 IF CNOMBRE==""
	 ELSE
	 SET CURSOR OFF
         @ YVEN2-4, XVEN1+3 SAY SPACE(53)
	 SET CURSOR ON
	 ENDIF
	 CNOMBRE=""
	 IF POSBAR<LIMITE
	    POSBAR=POSBAR+1
	 ELSE
	    SKIP LIMITE
	    IF (EOF())
	       SKIP -LIMITE
	    ELSE
	       SKIP -(LIMITE-1)
	    ENDIF
	 ENDIF
	CASE TECLA=271 // SHIFT+TAB
		CAMPOATRAS()
	CASE TECLA=9 // TAB
		POSBOT=POSBOT+1
		IF POSBOT>CNTV
			POSBOT=1
		ENDIF
		DO WHILE (VARN1[POSBOT]!=1 .AND. VARN1[POSBOT]!=2 .AND. VARN1[POSBOT]!=5 .AND. VARN1[POSBOT]!=6)
			POSBOT=POSBOT+1
			IF POSBOT>CNTV
				POSBOT=1
			ENDIF
		ENDDO
		DO CASE
			CASE VARN1[POSBOT]==1
				DIBITEM(1)
				DIBITEM(2)
				DIBITEM(6)
			CASE VARN1[POSBOT]==2
				DIBITEM(2)
				DIBITEM(6)
			CASE VARN1[POSBOT]==5
				DIBITEM(2)
				DIBITEM(6)
				EDITCAMPO()
			CASE VARN1[POSBOT]==6
				DIBITEM(2)
				DIBITEM(6)
		ENDCASE
      CASE TECLA==13
	 IF POSBAR>1
	    SKIP POSBAR-1
	 ENDIF
	 DIBUJAUND(POSBOT)
	 FRE=POSBOT
	 RETURN(0)
      CASE TECLA==27
	 IF POSBAR>1
	    SKIP POSBAR-1
	 ENDIF
	 FRE=0
	 RETURN(0)
      CASE TECLA==5
	 SET COLOR TO ("W+/B")
	 IF CNOMBRE==""
	 ELSE
	 SET CURSOR OFF
         @ YVEN2-4, XVEN1+3 SAY SPACE(53)
	 SET CURSOR ON
	 ENDIF
	 CNOMBRE=""
	 IF POSBAR>1
	    POSBAR=POSBAR-1
	 ELSE
	    SKIP -1
	 ENDIF
      CASE TECLA==18
	 SET COLOR TO ("W+/B")
	 IF CNOMBRE==""
	 ELSE
	 SET CURSOR OFF
         @ YVEN2-4, XVEN1+3 SAY SPACE(53)
	 SET CURSOR ON
	 ENDIF
	 CNOMBRE=""
	 SKIP -LIMITE
	 IF (BOF())
		POSBAR=1
	 ENDIF
      CASE TECLA==3
	 SET COLOR TO ("W+/B")
	 IF CNOMBRE==""
	 ELSE
	 SET CURSOR OFF
         @ YVEN2-4, XVEN1+3 SAY SPACE(53)
	 SET CURSOR ON
	 ENDIF
	 CNOMBRE=""
	 SKIP LIMITE*2
	 IF (EOF())
	    SKIP -LIMITE
	    POSBAR=LIMITE
	 ELSE
	    SKIP -LIMITE
	 ENDIF
      CASE TECLA==1
	 POSBAR=1
      CASE TECLA==6
	 POSBAR=LIMITE
      CASE TECLA==31
	 GO TOP
	 POSBAR=1
      CASE TECLA==30
	 GO BOTTOM
	 SKIP -(LIMITE-1)
	 POSBAR=LIMITE
      OTHERWISE
	 IF TECLA!=255
	    CNOMBRE=CNOMBRE+UPPER(CHR(TECLA))
	 ENDIF
	 XXTT=RECNO()
	 XPOSBAR=POSBAR
	CNOMBRE=SUBSTR(ALLTRIM(CNOMBRE),1,3)
	 SEEK(CNOMBRE)
	 IF FOUND()
	    POSBAR=1
	    SET CURSOR OFF
	    FOR A=1 TO LIMITE
	    IF (EOF())
	       POSBAR=POSBAR+1
	    ENDIF
	    SKIP
	    NEXT
	    SKIP -LIMITE
	    SET CURSOR ON
	 ELSE

	CNOMBRE=SUBSTR(ALLTRIM(CNOMBRE),1,3)
        CDIS=CNOMBRE
//	CDIS=SUBSTR(ALLTRIM(CDIS),1,3)
        SEEK(SUBSTR(ALLTRIM(CDIS),1,1))
	IF FOUND()
	   SIGUE=.T.
	   DO WHILE (SUBSTR(ALLTRIM(CDIS),1,1)==SUBSTR(ALLTRIM(DESDE),1,1)) .AND. (SIGUE==.T.)
		IF (ALLTRIM(CDIS)>=ALLTRIM(DESDE)) .AND. (ALLTRIM(CDIS)<=ALLTRIM(HASTA))
		    SKIP -1
		    POSBAR=1
		    SET CURSOR OFF
		    FOR A=1 TO LIMITE
		    IF (EOF())
		       POSBAR=POSBAR+1
		    ENDIF
		    SKIP
		    NEXT
		    SKIP -LIMITE
		    SET CURSOR ON
		    SIGUE=.F.
		ENDIF
		SKIP
	   ENDDO
	   IF (SIGUE)
	    IF LEN(CNOMBRE)!=1
	    CNOMBRE=LEFT(CNOMBRE, LEN(CNOMBRE)-1)
	    SEEK(CNOMBRE)
	    POSBAR=1
	    SET CURSOR OFF
	    FOR A=1 TO LIMITE
	    IF (EOF())
	       POSBAR=POSBAR+1
	    ENDIF
	    SKIP
	    NEXT
	    SKIP -LIMITE
	    ELSE
		CNOMBRE=""
		GO XXTT
		POSBAR=XPOSBAR
	    ENDIF
	    NO=1
	   ENDIF
	ELSE
	    IF LEN(CNOMBRE)!=1
	    CNOMBRE=LEFT(CNOMBRE, LEN(CNOMBRE)-1)
	    SEEK(CNOMBRE)
	    POSBAR=1
	    SET CURSOR OFF
	    FOR A=1 TO LIMITE
	    IF (EOF())
	       POSBAR=POSBAR+1
	    ENDIF
	    SKIP
	    NEXT
	    SKIP -LIMITE
	    ELSE
		CNOMBRE=""
		GO XXTT
		POSBAR=XPOSBAR
	    ENDIF
	    NO=1
	ENDIF
	ENDIF
      ENDCASE
      IF NO==0
	 SET CURSOR OFF
	 SET COLOR TO N/W
         @ YVEN1+2, XVEN1+3 SAY SUBSTR(CADTIT1,LIM,53)
         @ YVEN1+3, XVEN1+3 SAY SUBSTR(CADTIT2,LIM,53)
	 FOR A=1 TO LIMITE
	 IF A==POSBAR
	    SET COLOR TO ("N/BG")
	 ENDIF
         LISTA[A]=" "+DESDE+" ³ "+HASTA+" ³"+PAIS+"³"+PROVINCIA
         @ YVEN1+A+3, XVEN1+3 SAY SUBSTR(LISTA[A],LIM,53)
	 SET COLOR TO N/W
	 SKIP
	 NEXT
	 SKIP -LIMITE
	 SET CURSOR ON
      ENDIF
      NO=0
      SET CURSOR OFF
      SET COLOR TO ("W+/B")
      @ YVEN2-4, XVEN1+3 SAY LTRIM(CNOMBRE) + " "
      @ YVEN2-4, XVEN1+3+LEN(LTRIM(CNOMBRE)) SAY ""
      SET CURSOR ON
      SETPOS(YVEN2-4, XVEN1+3+LEN(CNOMBRE))
      MOUSE_ON()
   ENDIF
   ENDDO
MOUSE_OFF()
FRE=0
RETURN(0)

********************************************************************************
FUNCTION BUSCAPRE2
********************************************************************************
CNOMBRE=SPACE(53)
CNOMBRE=ALLTRIM(CNOMBRE)
POSBAR=1
TECLA=0
NO=0
LIM=1
SELECT 3
//SET ORDER TO 2
GO TOP
DECLARE LISTA[11]
FRE=1
RESETV()
CNTBOT=0
CNTV=0
POSBOT=1
TECLA=0
MOUSE=0
CADTIT1="Desde³Hasta³Pa¡s                ³Provincia           "
CADTIT2="ÄÄÄÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ"

   SELECT 2
   GO 5
   XVEN1=X1
   YVEN1=Y1
   XVEN2=X2
   YVEN2=Y2
   SELECT 3
   ACUMV(1, ((XVEN2-XVEN1)/2)-5, 13, 5, "    Ok    ")
   DESACTMENU()
   PANT()
   DIBVEN1()
   SET COLOR TO ("W+/B")
   SET CURSOR OFF
   @ YVEN2-4, XVEN1+3 SAY SPACE(53)
   SET CURSOR ON
   SET COLOR TO N/W
   @ YVEN1+2, XVEN1+3 SAY SUBSTR(CADTIT1,LIM,53)
   @ YVEN1+3, XVEN1+3 SAY SUBSTR(CADTIT2,LIM,53)
   MOUSE_ON()
   FOR A=1 TO 6
   IF A==POSBAR
      SET COLOR TO ("N/BG")
   ENDIF
   LISTA[A]=" "+DESDE+" ³ "+HASTA+" ³"+PAIS+"³"+PROVINCIA
   IF !EOF()
   MOUSE_OFF()
   @ YVEN1+A+3, XVEN1+3 SAY SUBSTR(LISTA[A],LIM,53) //DISTINTIVA
   MOUSE_ON()
   ENDIF
   SET COLOR TO N/W
   SKIP
   NEXT
   IF EOF()
	SKIP-1
   ENDIF
   SET COLOR TO ("W+/B")
   @ YVEN2-4, XVEN1+3 SAY LTRIM(CNOMBRE) + " "
   @ YVEN2-4, XVEN1+3+LEN(LTRIM(CNOMBRE)) SAY ""
   GO TOP
   TECLA=0
   LIMITE=6
   IF RECCOUNT()<7
      LIMITE=RECCOUNT()
   ENDIF
   MANTIENE()   
   
   DO WHILE (TECLA!=27)
      MOUSE=0
      TECLA=0
      X_MOUAUX1=0
      Y_MOUAUX1=0
      SPAUSA2()
   IF (MOUSE!=0)
   SET CURSOR OFF
   FOR G=1 TO CNTV
	IF (VARN1[G]==1) .AND. (MOUSE==1) .AND. (X_MOUSE>=VARN2[G]+XVEN1) .AND. (X_MOUSE<=VARN2[G]+LEN(VARC1[G])-1+XVEN1) .AND. (Y_MOUSE==VARN3[G]+YVEN1)
		POSBOT=G
		DIBUJAUND(G)
		MANTIENE()
		MOUSE=0
		IF (X_MOUSE>=VARN2[G]+XVEN1) .AND. (X_MOUSE<=VARN2[G]+LEN(VARC1[G])-1+XVEN1) .AND. (Y_MOUSE==VARN3[G]+YVEN1)
			IF POSBAR>1
				SKIP POSBAR-1
			ENDIF
			CNOMBRE=""
			MOUSE_OFF()
			SET CURSOR OFF
			SET COLOR TO ("W+/B")
                        @ YVEN2-4, XVEN1+3 SAY SPACE(53)
			FRE=G
			DIBITEM(1)
			DIBITEM(2)
			RETURN (0)
		ENDIF
		DIBITEM(1)
		DIBITEM(2)
	ENDIF
   NEXT G
   SET CURSOR ON
   SETPOS(YVEN2-4, XVEN1+3+LEN(CNOMBRE))
   IF (Y_MOUSE=YVEN1) .AND. (X_MOUSE>XVEN1) .AND. (X_MOUSE<XVEN2) .AND. (MOUSE==1)
	SET CURSOR OFF
	VENTF=SAVESCREEN(YVEN1+1,XVEN1+1,YVEN2-1,XVEN2-1)
	IF X_MOUSE=XVEN1+2
		MOUSE_OFF()
		FRE=0
		RETURN (0)
	ENDIF
	XREF1=X_MOUSE-XVEN1
	XREF2=XVEN2-X_MOUSE
	YREF=YVEN2-YVEN1
	DO WHILE (MOUSE!=0)
	   MOUSE=BOTR()
	   CADHORA2=SUBSTR(TIME(),1,SEGUN)
	   GMT=SUBSTR(TIME(),1,2)
	   NUMGMT=VAL(GMT)
           NUMGMT=NUMGMT+DIFHOR
	   IF NUMGMT>24
		NUMGMT=NUMGMT-24
	   ENDIF
	   IF NUMGMT<0
		NUMGMT=24+NUMGMT
	   ENDIF
	   CADHORA1=""
	   IF NUMGMT<10
		   CADHORA1 = "0" + ALLTRIM(STR(NUMGMT))
	   ELSE
		   CADHORA1 = ALLTRIM(STR(NUMGMT))
	   ENDIF
	   CADHORA1 = SUBSTR(CADHORA1,1,2)
	   CADHORA1 = CADHORA1 + SUBSTR(TIME(),3,SEGUN)
	   IF QUERELOJ=1
		IF !(MONOCROMO)
			HORA2(CADHORA1,SEGUN)
		ELSE
			HORAMONO2(CADHORA1,SEGUN)
		ENDIF
	   ELSE
		IF QUERELOJ=2
			IF !(MONOCROMO)
			   HORA2(CADHORA2,SEGUN)
			ELSE
			   HORAMONO2(CADHORA2,SEGUN)
			ENDIF
		ELSE
			IF !(MONOCROMO)
        	           HORA(CADHORA1,CADHORA2,SEGUN)
			ELSE
        	           HORAMONO(CADHORA1,CADHORA2,SEGUN)
			ENDIF
		ENDIF
	   ENDIF
	   IF (VARTIEMPO+30<SECONDS())
		SET CURSOR OFF
		DO PROTECT
		SET CURSOR ON
	   ENDIF
	   IF (POSX()/8!=X_MOUSE) .OR. (POSY()/8!=Y_MOUSE)
		VARTIEMPO=SECONDS()
	   ENDIF
	   X_MOUSE=POSX()/8
	   Y_MOUSE=POSY()/8
		SET CURSOR ON
	   IF (X_MOUSE!=POSX()/8) .OR. (Y_MOUSE!=POSY()/8) .OR. (X_MOUAUX1!=X_MOUSE) .OR. (Y_MOUAUX1!=Y_MOUSE)
		X_MOUAUX1=X_MOUSE
		Y_MOUAUX1=Y_MOUSE
		X_MOUSE=POSX()/8
		Y_MOUSE=POSY()/8
		MOUSE=BOTR()
		XVEN1=X_MOUSE-XREF1
		XVEN2=X_MOUSE+XREF2
		YVEN1=Y_MOUSE
		YVEN2=Y_MOUSE+YREF
		SET CURSOR OFF
		DIBVEN()
		SET CURSOR ON
		SETPOS(YVEN2-4, XVEN1+3+LEN(CNOMBRE))
	   ENDIF
	ENDDO
	SET COLOR TO ("N/W")
	MOUSE_OFF()
	SET CURSOR OFF
	@ YVEN1, XVEN1 TO YVEN2, XVEN2
	@ YVEN1, XVEN1+1 SAY "["+CHR(254)+"]"
	SET CURSOR ON
	MOUSE_ON()
	@ YVEN2-4, XVEN1+3+LEN(CNOMBRE) SAY ""
   ENDIF
   MANTIENE()
   ELSE
      SETPOS(YVEN2-4, XVEN1+3+LEN(CNOMBRE))
      MOUSE_OFF()
      DO CASE
      CASE TECLA==4
	SET COLOR TO ("W+/B")
	IF CNOMBRE==""
	ELSE
	SET CURSOR OFF
        @ YVEN2-4, XVEN1+3 SAY SPACE(53)
	SET CURSOR ON
	ENDIF
	CNOMBRE=""
	@ YVEN2-4, XVEN1+3+LEN(CNOMBRE) SAY ""
        IF (LIM==LEN(LISTA[1])-53)
		NO=1
	ENDIF
	LIM=LIM+5
        IF LIM+53>LEN(LISTA[1])
                LIM=LEN(LISTA[1])-53
	ENDIF
      CASE TECLA==19
	SET COLOR TO ("W+/B")
	IF CNOMBRE==""
	ELSE
	SET CURSOR OFF
        @ YVEN2-4, XVEN1+3 SAY SPACE(53)
	SET CURSOR ON
	ENDIF
	CNOMBRE=""
	@ YVEN2-4, XVEN1+3+LEN(CNOMBRE) SAY ""
	IF (LIM==1)
		NO=1
	ENDIF
	LIM=LIM-5
	IF LIM<1
		LIM=1
	ENDIF
      CASE TECLA==8
	 IF (LEN(CNOMBRE)!=0)
	    CNOMBRE=LEFT(CNOMBRE, LEN(CNOMBRE)-1)
	    KEYBOARD(CHR(255))
	 ENDIF
      CASE TECLA==24
	 SET COLOR TO ("W+/B")
	 IF CNOMBRE==""
	 ELSE
	 SET CURSOR OFF
         @ YVEN2-4, XVEN1+3 SAY SPACE(53)
	 SET CURSOR ON
	 ENDIF
	 CNOMBRE=""
	 IF POSBAR<LIMITE
	    POSBAR=POSBAR+1
	 ELSE
	    SKIP LIMITE
	    IF (EOF())
	       SKIP -LIMITE
	    ELSE
	       SKIP -(LIMITE-1)
	    ENDIF
	 ENDIF
	CASE TECLA=271 // SHIFT+TAB
		CAMPOATRAS()
	CASE TECLA=9 // TAB
		POSBOT=POSBOT+1
		IF POSBOT>CNTV
			POSBOT=1
		ENDIF
		DO WHILE (VARN1[POSBOT]!=1 .AND. VARN1[POSBOT]!=2 .AND. VARN1[POSBOT]!=5 .AND. VARN1[POSBOT]!=6)
			POSBOT=POSBOT+1
			IF POSBOT>CNTV
				POSBOT=1
			ENDIF
		ENDDO
		DO CASE
			CASE VARN1[POSBOT]==1
				DIBITEM(1)
				DIBITEM(2)
				DIBITEM(6)
			CASE VARN1[POSBOT]==2
				DIBITEM(2)
				DIBITEM(6)
			CASE VARN1[POSBOT]==5
				DIBITEM(2)
				DIBITEM(6)
				EDITCAMPO()
			CASE VARN1[POSBOT]==6
				DIBITEM(2)
				DIBITEM(6)
		ENDCASE
      CASE TECLA==13
	 IF POSBAR>1
	    SKIP POSBAR-1
	 ENDIF
	 DIBUJAUND(POSBOT)
	 FRE=POSBOT
	 RETURN(0)
      CASE TECLA==27
	 IF POSBAR>1
	    SKIP POSBAR-1
	 ENDIF
	 FRE=0
	 RETURN(0)
      CASE TECLA==5
	 SET COLOR TO ("W+/B")
	 IF CNOMBRE==""
	 ELSE
	 SET CURSOR OFF
         @ YVEN2-4, XVEN1+3 SAY SPACE(53)
	 SET CURSOR ON
	 ENDIF
	 CNOMBRE=""
	 IF POSBAR>1
	    POSBAR=POSBAR-1
	 ELSE
	    SKIP -1
	 ENDIF
      CASE TECLA==18
	 SET COLOR TO ("W+/B")
	 IF CNOMBRE==""
	 ELSE
	 SET CURSOR OFF
         @ YVEN2-4, XVEN1+3 SAY SPACE(53)
	 SET CURSOR ON
	 ENDIF
	 CNOMBRE=""
	 SKIP -LIMITE
	 IF (BOF())
		POSBAR=1
	 ENDIF
      CASE TECLA==3
	 SET COLOR TO ("W+/B")
	 IF CNOMBRE==""
	 ELSE
	 SET CURSOR OFF
         @ YVEN2-4, XVEN1+3 SAY SPACE(53)
	 SET CURSOR ON
	 ENDIF
	 CNOMBRE=""
	 SKIP LIMITE*2
	 IF (EOF())
	    SKIP -LIMITE
	    POSBAR=LIMITE
	 ELSE
	    SKIP -LIMITE
	 ENDIF
      CASE TECLA==1
	 POSBAR=1
      CASE TECLA==6
	 POSBAR=LIMITE
      CASE TECLA==31
	 GO TOP
	 POSBAR=1
      CASE TECLA==30
	 GO BOTTOM
	 SKIP -(LIMITE-1)
	 POSBAR=LIMITE
      OTHERWISE
	 IF TECLA!=255
	    CNOMBRE=CNOMBRE+UPPER(CHR(TECLA))
	 ENDIF
	 XXTT=RECNO()
	 XPOSBAR=POSBAR
	 SEEK(CNOMBRE)
	 IF FOUND()
	    POSBAR=1
	    SET CURSOR OFF
	    FOR A=1 TO LIMITE
	    IF (EOF())
	       POSBAR=POSBAR+1
	    ENDIF
	    SKIP
	    NEXT
	    SKIP -LIMITE
	    SET CURSOR ON
	 ELSE
	    IF LEN(CNOMBRE)!=1
	    CNOMBRE=LEFT(CNOMBRE, LEN(CNOMBRE)-1)
	    SEEK(CNOMBRE)
	    POSBAR=1
	    SET CURSOR OFF
	    FOR A=1 TO LIMITE
	    IF (EOF())
	       POSBAR=POSBAR+1
	    ENDIF
	    SKIP
	    NEXT
	    SKIP -LIMITE
	    ELSE
		CNOMBRE=""
		GO XXTT
		POSBAR=XPOSBAR
	    ENDIF
	    NO=1
	 ENDIF
      ENDCASE
      IF NO==0
	 SET CURSOR OFF
	 SET COLOR TO N/W
         @ YVEN1+2, XVEN1+3 SAY SUBSTR(CADTIT1,LIM,53)
         @ YVEN1+3, XVEN1+3 SAY SUBSTR(CADTIT2,LIM,53)
	 FOR A=1 TO LIMITE
	 IF A==POSBAR
	    SET COLOR TO ("N/BG")
	 ENDIF
         LISTA[A]=" "+DESDE+" ³ "+HASTA+" ³"+PAIS+"³"+PROVINCIA
         @ YVEN1+A+3, XVEN1+3 SAY SUBSTR(LISTA[A],LIM,53)
	 SET COLOR TO N/W
	 SKIP
	 NEXT
	 SKIP -LIMITE
	 SET CURSOR ON
      ENDIF
      NO=0
      SET CURSOR OFF
      SET COLOR TO ("W+/B")
      @ YVEN2-4, XVEN1+3 SAY LTRIM(CNOMBRE) + " "
      @ YVEN2-4, XVEN1+3+LEN(LTRIM(CNOMBRE)) SAY ""
      SET CURSOR ON
      SETPOS(YVEN2-4, XVEN1+3+LEN(CNOMBRE))
      MOUSE_ON()
   ENDIF
   ENDDO
MOUSE_OFF()
FRE=0
RETURN(0)

********************************************************************************
PROCEDURE DIBSUBTIT
********************************************************************************
SET COLOR TO ("N/W")
IF QUERELOJ=3
@ 24, 0 SAY " LOCAL  "
@ 24,16 SAY "   UTC  "
ELSE
IF QUERELOJ=1
@ 24, 0 SAY "   UTC  "
@ 24,16 SAY "                                                           "
ELSE
@ 24, 0 SAY " LOCAL  "
@ 24,16 SAY "                                                           "
ENDIF
ENDIF
IF SEGUN==5
@ 24,13 SAY "   "
@ 24,29 SAY "   "
ENDIF
RETURN

